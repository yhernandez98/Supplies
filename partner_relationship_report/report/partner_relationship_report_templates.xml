<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="partner_relationship_report_pdf">
    <t t-call="web.html_container">
      <t t-foreach="docs" t-as="doc">
        <t t-call="partner_relationship_report.partner_relationship_report_pdf_document"/>
      </t>
    </t>
  </template>

  <template id="partner_relationship_report_pdf_document">
    <t t-set="company" t-value="env.company"/>
    <t t-call="web.internal_layout">
      <div class="page">
        <t t-set="p" t-value="doc.partner_id"/>
        <t t-set="lines" t-value="doc.get_report_lines()"/>

        <div class="text-center">
          <h2>RELACIÓN DE PRODUCTOS Y ASOCIADOS</h2>
          <strong>
            <span>Fecha corte: </span>
            <span t-esc="doc._get_today_str()"/>
          </strong>
        </div>

        <!-- Cabecera del contacto -->
        <table class="table table-sm" style="width:100%; margin-top:8px;">
          <tbody>
            <tr>
              <td style="width:18%;"><strong>EMPRESA:</strong></td>
              <td style="width:47%;"><t t-esc="p.name or ''"/></td>
              <td style="width:20%;"><strong>TELÉFONO:</strong></td>
              <td style="width:15%;"><t t-esc="p.phone or ''"/></td>
            </tr>
            <tr>
              <td><strong>NIT:</strong></td>
              <td><t t-esc="p.vat or ''"/></td>
              <td><strong>CORREO:</strong></td>
              <td><t t-esc="p.email or ''"/></td>
            </tr>
            <tr>
              <td><strong>DIRECCIÓN:</strong></td>
              <td colspan="3"><t t-esc="p.contact_address or ''"/></td>
            </tr>
          </tbody>
        </table>

        <h3 style="background:#004f9f;color:#fff;padding:6px 8px;margin-top:10px;">
          PRODUCTO PRINCIPAL Y ASOCIADOS (Componentes, Periféricos, Complementos)
        </h3>

      <table class="table table-sm" style="width:100%; border-collapse:collapse;">
        <thead>
          <tr style="background:#e9ecef;">
            <th style="border:1px solid #000; width:16%;">Serial</th>
            <th style="border:1px solid #000; width:16%;">Modelo</th>
            <th style="border:1px solid #000; width:16%;">Código de facturación</th>
            <th style="border:1px solid #000; width:10%;">Cantidad</th>
            <th style="border:1px solid #000;">Producto</th>
            <th style="border:1px solid #000; width:20%;">Producto principal</th>
            <th style="border:1px solid #000; width:16%;">Serial principal</th>
          </tr>
        </thead>
        <tbody>
          <t t-foreach="lines" t-as="grp">
            <!-- Fila del principal -->
            <tr style="background:#f8f9fa;">
              <td style="border:1px solid #000;"><t t-esc="grp['principal_serial']"/></td>
              <td style="border:1px solid #000;"><t t-esc="grp['principal_model']"/></td>
              <td style="border:1px solid #000;"><t t-esc="grp['principal_billing_code']"/></td>
              <td style="border:1px solid #000; text-align:right;"><t t-esc="grp['principal_qty']"/></td>
              <td style="border:1px solid #000;"><t t-esc="grp['principal_product']"/></td>
              <td style="border:1px solid #000;"><t t-esc="grp['principal_product']"/></td>
              <td style="border:1px solid #000;"><t t-esc="grp['principal_serial']"/></td>
            </tr>

            <!-- Filas de asociados -->
            <t t-foreach="grp['lines']" t-as="ln">
              <tr>
                <td style="border:1px solid #000;"><t t-esc="ln['serial']"/></td>
                <td style="border:1px solid #000;"><t t-esc="ln['model']"/></td>
                <td style="border:1px solid #000;"><t t-esc="ln['billing_code']"/></td>
                <td style="border:1px solid #000; text-align:right;"><t t-esc="ln['qty']"/></td>
                <td style="border:1px solid #000;"><t t-esc="ln['product']"/></td>
                <td style="border:1px solid #000;"><t t-esc="grp['principal_product']"/></td>
                <td style="border:1px solid #000;"><t t-esc="grp['principal_serial']"/></td>
              </tr>
            </t>
          </t>

          <t t-if="not lines">
            <tr>
              <td colspan="7" style="border:1px solid #000; padding:6px; color:#6c757d; text-align:center;">
                No hay productos con asociados para este contacto.
              </td>
            </tr>
          </t>
        </tbody>
      </table>

        <div style="margin-top:10px;">
          <strong>Observaciones:</strong>
          <div style="min-height:44px; border:1px solid #bbb; padding:6px; text-align:left;">
            <t t-esc="doc.observation or ''"/>
          </div>
        </div>
      </div>
    </t>
  </template>
</odoo>
