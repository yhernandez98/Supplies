<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Reporte PDF de Contrato de Leasing -->
        <record id="action_report_leasing_contract" model="ir.actions.report">
            <field name="name">Contrato de Leasing</field>
            <field name="model">leasing.contract</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">crm_sales_supplies.report_leasing_contract</field>
            <field name="report_file">crm_sales_supplies.report_leasing_contract</field>
            <field name="print_report_name">'Contrato_%(name)s'</field>
            <field name="binding_model_id" ref="crm_sales_supplies.model_leasing_contract"/>
            <field name="binding_type">report</field>
        </record>

        <!-- Plantilla QWeb del Reporte -->
        <template id="report_leasing_contract">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="contract">
                    <t t-call="web.external_layout">
                        <div class="page" style="padding: 40px; font-family: 'Arial', sans-serif; color: #2c3e50;">
                            <!-- Si hay contenido renderizado, mostrarlo -->
                            <t t-if="contract.rendered_content">
                                <div t-raw="contract.rendered_content"/>
                            </t>
                            <!-- Si no hay plantilla, mostrar información básica -->
                            <t t-else="">
                                <!-- Encabezado -->
                                <div style="text-align: center; margin-bottom: 40px; border-bottom: 3px solid #4a90e2; padding-bottom: 20px;">
                                    <h1 style="color: #4a90e2; margin: 0; font-size: 32px; font-weight: bold;">
                                        CONTRATO DE LEASING
                                    </h1>
                                    <p style="color: #6c757d; margin: 10px 0 0 0; font-size: 16px;">
                                        Número: <strong t-esc="contract.name or 'N/A'"/>
                                    </p>
                                </div>

                                <!-- Información General -->
                                <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px; border-left: 5px solid #4a90e2;">
                                    <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #4a90e2; padding-bottom: 10px;">
                                        INFORMACIÓN GENERAL
                                    </h2>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <tr t-if="contract.partner_id">
                                            <td style="width: 30%; padding: 12px; font-weight: bold; color: #495057; font-size: 14px;">Cliente:</td>
                                            <td style="padding: 12px; color: #212529; font-size: 16px;"><strong><t t-esc="contract.partner_id.display_name"/></strong></td>
                                        </tr>
                                        <tr t-if="contract.brand_ids">
                                            <td style="padding: 12px; font-weight: bold; color: #495057; font-size: 14px;">Marcas:</td>
                                            <td style="padding: 12px; color: #212529; font-size: 16px;">
                                                <t t-foreach="contract.brand_ids" t-as="brand">
                                                    <t t-esc="brand.name"/><t t-if="brand_index &lt; len(contract.brand_ids) - 1">, </t>
                                                </t>
                                            </td>
                                        </tr>
                                        <tr t-if="contract.brand_id and not contract.brand_ids">
                                            <td style="padding: 12px; font-weight: bold; color: #495057; font-size: 14px;">Marca:</td>
                                            <td style="padding: 12px; color: #212529; font-size: 16px;"><t t-esc="contract.brand_id.name"/></td>
                                        </tr>
                                        <tr t-if="contract.start_date">
                                            <td style="padding: 12px; font-weight: bold; color: #495057; font-size: 14px;">Fecha de Inicio:</td>
                                            <td style="padding: 12px; color: #212529; font-size: 16px;"><t t-esc="contract.start_date"/></td>
                                        </tr>
                                        <tr t-if="contract.end_date">
                                            <td style="padding: 12px; font-weight: bold; color: #495057; font-size: 14px;">Fecha de Fin:</td>
                                            <td style="padding: 12px; color: #212529; font-size: 16px;"><t t-esc="contract.end_date"/></td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 12px; font-weight: bold; color: #495057; font-size: 14px;">Estado:</td>
                                            <td style="padding: 12px; color: #212529; font-size: 16px;">
                                                <span t-if="contract.state == 'draft'" style="background: #ffc107; color: #000; padding: 6px 12px; border-radius: 4px; font-weight: bold;">Borrador</span>
                                                <span t-if="contract.state == 'active'" style="background: #28a745; color: #fff; padding: 6px 12px; border-radius: 4px; font-weight: bold;">Activo</span>
                                                <span t-if="contract.state == 'expired'" style="background: #6c757d; color: #fff; padding: 6px 12px; border-radius: 4px; font-weight: bold;">Vencido</span>
                                                <span t-if="contract.state == 'cancelled'" style="background: #dc3545; color: #fff; padding: 6px 12px; border-radius: 4px; font-weight: bold;">Cancelado</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>

                                <!-- Proveedores -->
                                <div t-if="contract.provider_ids" style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px; border-left: 5px solid #28a745;">
                                    <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #28a745; padding-bottom: 10px;">
                                        PROVEEDORES ASIGNADOS
                                    </h2>
                                    <ul style="list-style: none; padding: 0; margin: 0;">
                                        <t t-foreach="contract.provider_ids" t-as="provider">
                                            <li style="padding: 8px 0; font-size: 16px; border-bottom: 1px solid #dee2e6;">
                                                <strong><t t-esc="provider.display_name"/></strong>
                                                <t t-if="provider.vat"> - NIT: <t t-esc="provider.vat"/></t>
                                            </li>
                                        </t>
                                    </ul>
                                </div>

                                <!-- Productos -->
                                <div t-if="contract.product_line_ids" style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-bottom: 30px; border-left: 5px solid #ff9800;">
                                    <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #ff9800; padding-bottom: 10px;">
                                        PRODUCTOS INCLUIDOS
                                    </h2>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background-color: #ff9800; color: white;">
                                                <th style="padding: 12px; text-align: left; border: 1px solid #f57c00;">Producto</th>
                                                <th style="padding: 12px; text-align: left; border: 1px solid #f57c00;">Código</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="contract.product_line_ids.filtered(lambda l: l.active)" t-as="line">
                                                <tr>
                                                    <td style="padding: 10px; border: 1px solid #dee2e6;"><t t-esc="line.product_id.display_name"/></td>
                                                    <td style="padding: 10px; border: 1px solid #dee2e6;"><t t-esc="line.product_id.default_code or 'N/A'"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Notas -->
                                <div t-if="contract.notes" style="background: #fff3cd; padding: 20px; border-radius: 10px; margin-bottom: 30px; border-left: 5px solid #ffc107;">
                                    <h2 style="color: #856404; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #ffc107; padding-bottom: 8px;">
                                        NOTAS
                                    </h2>
                                    <div style="color: #856404; font-size: 14px; line-height: 1.6;">
                                        <t t-raw="contract.notes.replace('\n', '&lt;br/&gt;')"/>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>

