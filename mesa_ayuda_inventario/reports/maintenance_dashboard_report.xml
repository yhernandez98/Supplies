<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Reporte PDF del Dashboard de Mantenimientos -->
        <record id="action_report_maintenance_dashboard" model="ir.actions.report">
            <field name="name">Dashboard de Mantenimientos</field>
            <field name="model">maintenance.dashboard</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">mesa_ayuda_inventario.report_maintenance_dashboard</field>
            <field name="report_file">mesa_ayuda_inventario.report_maintenance_dashboard</field>
            <field name="print_report_name">'Dashboard de Mantenimientos - %s' % (object.name or 'Sin Referencia')</field>
            <field name="binding_model_id" ref="mesa_ayuda_inventario.model_maintenance_dashboard"/>
            <field name="binding_type">report</field>
        </record>

        <!-- Plantilla QWeb del Reporte -->
        <template id="report_maintenance_dashboard">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="dashboard">
                    <t t-call="web.external_layout">
                        <div class="page">
                            <div class="oe_structure">
                                <!-- Encabezado -->
                                <div style="text-align: center; border-bottom: 3px solid #667eea; padding-bottom: 15px; margin-bottom: 30px;">
                                    <h1 style="color: #2c3e50; margin: 0; font-size: 28px; font-weight: bold;">
                                        üìä DASHBOARD DE MANTENIMIENTOS
                                    </h1>
                                    <p style="color: #6c757d; margin: 5px 0; font-size: 14px;">
                                        Resumen General del Sistema de Mantenimiento
                                    </p>
                                    <p style="color: #6c757d; margin: 5px 0; font-size: 12px;">
                                        <t t-if="dashboard.date_from">Desde: <t t-esc="dashboard.date_from"/></t>
                                        <t t-if="dashboard.date_to"> hasta <t t-esc="dashboard.date_to"/></t>
                                        <t t-if="dashboard.technician_id"> | T√©cnico: <t t-esc="dashboard.technician_id.name"/></t>
                                    </p>
                                    <p style="color: #6c757d; margin: 5px 0; font-size: 12px;">
                                        Generado el <t t-esc="datetime.datetime.now().strftime('%d/%m/%Y a las %H:%M')"/>
                                    </p>
                                </div>

                                <!-- M√©tricas Principales -->
                                <div style="margin-bottom: 30px;">
                                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                        üîß M√âTRICAS PRINCIPALES
                                    </h2>
                                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                                        <thead>
                                            <tr style="background-color: #667eea; color: white;">
                                                <th style="padding: 12px; text-align: left; border: 1px solid #5568d3;">M√©trica</th>
                                                <th style="padding: 12px; text-align: center; border: 1px solid #5568d3;">Valor</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td style="padding: 10px; border: 1px solid #ddd;">Total Mantenimientos</td>
                                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 16px;"><t t-esc="dashboard.total_maintenances"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa;">
                                                <td style="padding: 10px; border: 1px solid #ddd;">Pendientes</td>
                                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 16px; color: #f5576c;"><t t-esc="dashboard.pending_maintenances"/></td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px; border: 1px solid #ddd;">Completados</td>
                                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 16px; color: #4facfe;"><t t-esc="dashboard.completed_maintenances"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa;">
                                                <td style="padding: 10px; border: 1px solid #ddd;">Vencidos</td>
                                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 16px; color: #fa709a;"><t t-esc="dashboard.overdue_maintenances"/></td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px; border: 1px solid #ddd;">Total Tickets</td>
                                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 16px;"><t t-esc="dashboard.total_tickets"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa;">
                                                <td style="padding: 10px; border: 1px solid #ddd;">Tickets Abiertos</td>
                                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 16px;"><t t-esc="dashboard.open_tickets"/></td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 10px; border: 1px solid #ddd;">Total Reparaciones</td>
                                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 16px;"><t t-esc="dashboard.total_repairs"/></td>
                                            </tr>
                                            <tr style="background-color: #f8f9fa;">
                                                <td style="padding: 10px; border: 1px solid #ddd;">Reparaciones Activas</td>
                                                <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold; font-size: 16px;"><t t-esc="dashboard.active_repairs"/></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Rendimiento por T√©cnico -->
                                <div style="margin-bottom: 30px;">
                                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                        üë• RENDIMIENTO POR T√âCNICO
                                    </h2>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background-color: #667eea; color: white;">
                                                <th style="padding: 10px; text-align: left; border: 1px solid #5568d3;">T√©cnico</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Total</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Completados</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">% Completados</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="dashboard.technician_performance_ids" t-as="perf">
                                                <tr>
                                                    <td style="padding: 8px; border: 1px solid #ddd;"><t t-esc="perf.technician_id.name or 'Sin nombre'"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="perf.total_maintenances"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="perf.completed_maintenances"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd; font-weight: bold;">
                                                        <t t-esc="'{:.2f}'.format(perf.completion_rate * 100) if perf.completion_rate else '0.00'"/>%
                                                    </td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Mantenimientos por Cliente -->
                                <div style="margin-bottom: 30px;">
                                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                        üè¢ MANTENIMIENTOS POR CLIENTE
                                    </h2>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background-color: #667eea; color: white;">
                                                <th style="padding: 10px; text-align: left; border: 1px solid #5568d3;">Cliente</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Total</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Pendientes</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Completados</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="dashboard.client_maintenance_ids" t-as="client">
                                                <tr>
                                                    <td style="padding: 8px; border: 1px solid #ddd;"><t t-esc="client.partner_id.name or 'Sin nombre'"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="client.total_maintenances"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="client.pending_maintenances"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="client.completed_maintenances"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Tendencia Mensual -->
                                <div style="margin-bottom: 30px;">
                                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                        üìà TENDENCIA MENSUAL DE MANTENIMIENTOS
                                    </h2>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background-color: #667eea; color: white;">
                                                <th style="padding: 10px; text-align: left; border: 1px solid #5568d3;">Mes</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Total</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Completados</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Pendientes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="dashboard.monthly_trend_ids" t-as="trend">
                                                <tr>
                                                    <td style="padding: 8px; border: 1px solid #ddd;"><t t-esc="trend.month"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="trend.total_maintenances"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="trend.completed_maintenances"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="trend.pending_maintenances"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Distribuci√≥n por Tipo -->
                                <div style="margin-bottom: 30px;">
                                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                        ü•ß DISTRIBUCI√ìN POR TIPO DE MANTENIMIENTO
                                    </h2>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background-color: #667eea; color: white;">
                                                <th style="padding: 10px; text-align: left; border: 1px solid #5568d3;">Tipo de Mantenimiento</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Cantidad</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="dashboard.type_distribution_ids" t-as="dist">
                                                <tr>
                                                    <td style="padding: 8px; border: 1px solid #ddd;"><t t-esc="dist.type_label"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd; font-weight: bold;"><t t-esc="dist.count"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- Equipos M√°s Problem√°ticos -->
                                <div style="margin-bottom: 30px;">
                                    <h2 style="color: #2c3e50; margin-bottom: 15px; font-size: 20px; border-bottom: 2px solid #667eea; padding-bottom: 8px;">
                                        ‚ö†Ô∏è EQUIPOS M√ÅS PROBLEM√ÅTICOS (Top 10)
                                    </h2>
                                    <table style="width: 100%; border-collapse: collapse;">
                                        <thead>
                                            <tr style="background-color: #667eea; color: white;">
                                                <th style="padding: 10px; text-align: left; border: 1px solid #5568d3;">Equipo</th>
                                                <th style="padding: 10px; text-align: left; border: 1px solid #5568d3;">Placa de Inventario</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Total</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Completados</th>
                                                <th style="padding: 10px; text-align: center; border: 1px solid #5568d3;">Pendientes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="dashboard.problematic_equipment_ids[:10]" t-as="eq">
                                                <tr>
                                                    <td style="padding: 8px; border: 1px solid #ddd;"><t t-esc="eq.equipment_name or 'Sin nombre'"/></td>
                                                    <td style="padding: 8px; border: 1px solid #ddd;"><t t-esc="eq.inventory_plate or 'N/A'"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="eq.total_maintenances"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="eq.completed_maintenances"/></td>
                                                    <td style="padding: 8px; text-align: center; border: 1px solid #ddd;"><t t-esc="eq.pending_maintenances"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>

                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>

