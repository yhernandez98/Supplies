<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Reporte PDF de Orden de Mantenimiento Completa -->
        <record id="action_report_maintenance_order" model="ir.actions.report">
            <field name="name">Reporte de Orden de Mantenimiento</field>
            <field name="model">maintenance.order</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">mesa_ayuda_inventario.report_maintenance_order</field>
            <field name="report_file">mesa_ayuda_inventario.report_maintenance_order</field>
            <field name="print_report_name">'Reporte de Orden - %s' % (object.name or 'Sin Referencia')</field>
            <field name="binding_model_id" ref="mesa_ayuda_inventario.model_maintenance_order"/>
            <field name="binding_type">report</field>
        </record>

        <!-- Plantilla QWeb del Reporte -->
        <template id="report_maintenance_order">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="order">
                    <t t-call="web.external_layout">
                        <div class="page" style="padding: 30px; font-family: 'Arial', sans-serif; color: #2c3e50;">
                            <!-- Encabezado -->
                            <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #4a90e2; padding-bottom: 20px;">
                                <h1 style="color: #4a90e2; margin: 0; font-size: 28px; font-weight: bold;">
                                    REPORTE DE ORDEN DE MANTENIMIENTO
                                </h1>
                                <p style="color: #6c757d; margin: 5px 0 0 0; font-size: 14px;">
                                    <t t-esc="order.name or 'Sin Referencia'"/>
                                </p>
                            </div>

                            <!-- Informaci贸n General de la Orden -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #4a90e2;">
                                <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #4a90e2; padding-bottom: 8px;">
                                     INFORMACIN GENERAL
                                </h2>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr t-if="order.partner_id">
                                        <td style="width: 35%; padding: 8px; font-weight: bold; color: #495057;">Cliente:</td>
                                        <td style="padding: 8px; color: #212529; font-size: 16px;"><strong><t t-esc="order.partner_id.display_name"/></strong></td>
                                    </tr>
                                    <tr t-if="order.scheduled_date">
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">Fecha Programada:</td>
                                        <td style="padding: 8px; color: #212529;"><t t-esc="order.scheduled_date"/></td>
                                    </tr>
                                    <tr t-if="order.technician_ids">
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">T茅cnicos Asignados:</td>
                                        <td style="padding: 8px; color: #212529;">
                                            <t t-foreach="order.technician_ids" t-as="tech">
                                                <t t-esc="tech.display_name"/><t t-if="tech_index &lt; len(order.technician_ids) - 1">, </t>
                                            </t>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">Estado:</td>
                                        <td style="padding: 8px; color: #212529;">
                                            <span t-if="order.state == 'draft'" style="background: #ffc107; color: #000; padding: 4px 8px; border-radius: 4px; font-weight: bold;">Borrador</span>
                                            <span t-if="order.state == 'scheduled'" style="background: #17a2b8; color: #fff; padding: 4px 8px; border-radius: 4px; font-weight: bold;">Programada</span>
                                            <span t-if="order.state == 'in_progress'" style="background: #007bff; color: #fff; padding: 4px 8px; border-radius: 4px; font-weight: bold;">En Progreso</span>
                                            <span t-if="order.state == 'completed'" style="background: #28a745; color: #fff; padding: 4px 8px; border-radius: 4px; font-weight: bold;">Completada</span>
                                            <span t-if="order.state == 'cancelled'" style="background: #dc3545; color: #fff; padding: 4px 8px; border-radius: 4px; font-weight: bold;">Cancelada</span>
                                        </td>
                                    </tr>
                                    <tr t-if="order.description">
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">Descripci贸n:</td>
                                        <td style="padding: 8px; color: #212529;"><t t-esc="order.description"/></td>
                                    </tr>
                                </table>
                            </div>

                            <!-- Equipos Mantenidos -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #28a745;">
                                <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #28a745; padding-bottom: 8px;">
                                     EQUIPOS MANTENIDOS
                                </h2>
                                
                                <t t-foreach="order.maintenance_ids" t-as="maint" t-index="maint_index">
                                    <div style="background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
                                        <!-- Informaci贸n del Equipo -->
                                        <h3 style="color: #4a90e2; margin-top: 0; margin-bottom: 15px; font-size: 16px; border-bottom: 1px solid #4a90e2; padding-bottom: 5px;">
                                            Equipo <t t-esc="maint_index + 1"/> de <t t-esc="len(order.maintenance_ids)"/>
                                        </h3>
                                        
                                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 15px;">
                                            <tr t-if="maint.lot_id">
                                                <td style="width: 30%; padding: 6px; font-weight: bold; color: #495057;">N煤mero de Serie:</td>
                                                <td style="padding: 6px; color: #212529;"><strong><t t-esc="maint.lot_id.name"/></strong></td>
                                            </tr>
                                            <tr t-if="maint.inventory_plate">
                                                <td style="padding: 6px; font-weight: bold; color: #495057;">Placa de Inventario:</td>
                                                <td style="padding: 6px; color: #212529;"><strong><t t-esc="maint.inventory_plate"/></strong></td>
                                            </tr>
                                            <tr t-if="maint.product_id">
                                                <td style="padding: 6px; font-weight: bold; color: #495057;">Producto:</td>
                                                <td style="padding: 6px; color: #212529;"><t t-esc="maint.product_id.display_name or 'N/A'"/></td>
                                            </tr>
                                            <tr>
                                                <td style="padding: 6px; font-weight: bold; color: #495057;">Tipo de Servicio:</td>
                                                <td style="padding: 6px; color: #212529;">
                                                    <t t-if="maint.maintenance_type == 'preventive'">Mantenimiento Preventivo</t>
                                                    <t t-if="maint.maintenance_type == 'corrective'">Mantenimiento Correctivo</t>
                                                    <t t-if="maint.maintenance_type == 'remote_support'">Soporte T茅cnico Remoto</t>
                                                    <t t-if="maint.maintenance_type == 'onsite_support'">Soporte T茅cnico en Sitio</t>
                                                    <t t-if="maint.maintenance_type == 'diagnosis'">Diagn贸stico y Evaluaci贸n</t>
                                                    <t t-if="maint.maintenance_type == 'installation'">Instalaci贸n y Configuraci贸n</t>
                                                    <t t-if="maint.maintenance_type == 'server_implementation'">Implementaci贸n de Servidores</t>
                                                    <t t-if="maint.maintenance_type == 'server_migration'">Migraci贸n de Servidores</t>
                                                    <t t-if="maint.maintenance_type == 'backup_recovery'">Backup y Recuperaci贸n</t>
                                                    <t t-if="maint.maintenance_type == 'firewall_vpn'">Configuraci贸n de Firewall/VPN</t>
                                                    <t t-if="maint.maintenance_type == 'licensing_m365'">Gesti贸n de Licenciamiento M365</t>
                                                    <t t-if="maint.maintenance_type == 'admin_m365'">Administraci贸n de M365 / SharePoint</t>
                                                    <t t-if="maint.maintenance_type == 'upgrade'">Actualizaci贸n / Mejora</t>
                                                    <t t-if="maint.maintenance_type == 'other'">Otro</t>
                                                </td>
                                            </tr>
                                            <tr t-if="maint.technician_ids">
                                                <td style="padding: 6px; font-weight: bold; color: #495057;">T茅cnicos:</td>
                                                <td style="padding: 6px; color: #212529;">
                                                    <t t-foreach="maint.technician_ids" t-as="tech">
                                                        <t t-esc="tech.display_name"/><t t-if="tech_index &lt; len(maint.technician_ids) - 1">, </t>
                                                    </t>
                                                </td>
                                            </tr>
                                            <tr t-if="maint.maintenance_date">
                                                <td style="padding: 6px; font-weight: bold; color: #495057;">Fecha:</td>
                                                <td style="padding: 6px; color: #212529;"><t t-esc="maint.maintenance_date"/></td>
                                            </tr>
                                        </table>
                                        
                                        <!-- Licencias Asignadas al Equipo -->
                                        <t t-set="equipment_licenses" t-value="maint.lot_id._get_assigned_licenses() if maint.lot_id else []"/>
                                        <div t-if="equipment_licenses and len(equipment_licenses) > 0" style="margin-top: 15px; padding: 15px; background: #fff3e0; border-radius: 5px; border-left: 3px solid #ff9800;">
                                            <h4 style="color: #495057; font-size: 14px; margin-bottom: 10px;"> Licencias Asignadas al Equipo</h4>
                                            <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                                                <thead>
                                                    <tr style="background-color: #ff9800; color: white;">
                                                        <th style="padding: 6px; text-align: left; border: 1px solid #f57c00;">Licencia</th>
                                                        <th style="padding: 6px; text-align: left; border: 1px solid #f57c00;">Producto/Servicio</th>
                                                        <th style="padding: 6px; text-align: left; border: 1px solid #f57c00;">Cliente</th>
                                                        <th style="padding: 6px; text-align: left; border: 1px solid #f57c00;">Fecha Asignaci贸n</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <t t-foreach="equipment_licenses" t-as="license">
                                                        <tr>
                                                            <td style="padding: 5px; border: 1px solid #ffe0b2;"><t t-esc="license.license_id.name or 'N/A'"/></td>
                                                            <td style="padding: 5px; border: 1px solid #ffe0b2;"><t t-esc="(license.license_id and license.license_id.product_id and license.license_id.product_id.display_name) or 'N/A'"/></td>
                                                            <td style="padding: 5px; border: 1px solid #ffe0b2;"><t t-esc="license.partner_id.display_name or 'N/A'"/></td>
                                                            <td style="padding: 5px; border: 1px solid #ffe0b2;">
                                                                <t t-if="license.assignment_date"><t t-esc="license.assignment_date"/></t>
                                                                <t t-else="">N/A</t>
                                                            </td>
                                                        </tr>
                                                    </t>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <!-- Descripci贸n del Trabajo -->
                                        <div t-if="maint.description" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                            <strong style="color: #495057;">Descripci贸n del Trabajo:</strong>
                                            <div style="margin-top: 8px; color: #212529;">
                                                <t t-esc="maint.description"/>
                                            </div>
                                        </div>
                                        
                                        <!-- Observaciones -->
                                        <div t-if="maint.observations" style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;">
                                            <strong style="color: #856404;">Observaciones:</strong>
                                            <div style="margin-top: 8px; color: #212529;">
                                                <t t-esc="maint.observations"/>
                                            </div>
                                        </div>
                                        
                                        <!-- Firma del T茅cnico Principal de este Mantenimiento -->
                                        <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; border-top: 2px solid #4a90e2;">
                                            <h4 style="color: #495057; font-size: 14px; margin-bottom: 10px; text-align: center;">
                                                Firma del T茅cnico Principal
                                            </h4>
                                            <div style="display: flex; gap: 20px; justify-content: space-around; align-items: flex-start;">
                                                <div style="flex: 1; text-align: center;">
                                                    <div style="min-height: 100px; border: 2px dashed #4a90e2; border-radius: 5px; padding: 10px; background: white; display: flex; align-items: center; justify-content: center;">
                                                        <t t-if="maint.technician_signature">
                                                            <img t-att-src="image_data_uri(maint.technician_signature)" style="max-width: 100%; max-height: 100px; object-fit: contain;"/>
                                                        </t>
                                                        <t t-else="">
                                                            <span style="color: #999;">No firmado</span>
                                                        </t>
                                                    </div>
                                                    <p t-if="maint.technician_id" style="margin-top: 10px; font-size: 12px; color: #495057;">
                                                        <strong><t t-esc="maint.technician_id.display_name"/></strong>
                                                        <t t-if="maint.technician_signed_date">
                                                            <br/><span style="font-size: 11px; color: #6c757d;"><t t-esc="maint.technician_signed_date"/></span>
                                                        </t>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>

                            <!-- Firmas -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #6c757d;">
                                <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #6c757d; padding-bottom: 8px;">
                                    锔 FIRMAS
                                </h2>
                                <div style="display: flex; gap: 30px; justify-content: space-around;">
                                    <div style="flex: 1; text-align: center;">
                                        <h3 style="color: #495057; font-size: 14px; margin-bottom: 10px;">Firma del Cliente</h3>
                                        <div style="min-height: 80px; border: 2px dashed #dee2e6; border-radius: 5px; padding: 10px; background: white;">
                                            <t t-if="order.customer_signature">
                                                <img t-att-src="image_data_uri(order.customer_signature)" style="max-width: 100%; max-height: 80px; object-fit: contain;"/>
                                            </t>
                                            <t t-else="">
                                                <span style="color: #999;">No firmado</span>
                                            </t>
                                        </div>
                                        <p t-if="order.customer_signed_by" style="margin-top: 10px; font-size: 12px; color: #6c757d;">
                                            <strong><t t-esc="order.customer_signed_by.display_name"/></strong>
                                            <t t-if="order.customer_signed_date"><br/><t t-esc="order.customer_signed_date"/></t>
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- Pie de p谩gina -->
                            <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #dee2e6; text-align: center; color: #6c757d; font-size: 12px;">
                                <p>Este documento fue generado mediante el sistema de Mesa de Ayuda - Inventario</p>
                                <p>Total de equipos mantenidos: <strong><t t-esc="len(order.maintenance_ids)"/></strong></p>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>

