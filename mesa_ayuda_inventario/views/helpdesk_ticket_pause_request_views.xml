<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_helpdesk_ticket_pause_request_tree" model="ir.ui.view">
            <field name="name">helpdesk.ticket.pause.request.tree</field>
            <field name="model">helpdesk.ticket.pause.request</field>
            <field name="arch" type="xml">
                <list string="Solicitudes de pausa (tickets)" create="0" delete="0">
                    <field name="name"/>
                    <field name="ticket_id"/>
                    <field name="requested_by_id"/>
                    <field name="request_datetime"/>
                    <field name="time_at_request" string="Tiempo en solicitud (h)"/>
                    <field name="approver_to_notify_id" string="Pendiente para"/>
                    <field name="state" decoration-info="state == 'pending'" decoration-success="state == 'approved'" decoration-danger="state == 'rejected'"/>
                    <field name="approver_id" column_invisible="1"/>
                    <field name="approve_datetime" column_invisible="1"/>
                    <button name="action_approve" string="Autorizar" type="object" class="btn-primary" icon="fa-check" invisible="state != 'pending'"/>
                    <button name="action_reject" string="Rechazar" type="object" class="btn-secondary" icon="fa-times" invisible="state != 'pending'"/>
                </list>
            </field>
        </record>

        <record id="view_helpdesk_ticket_pause_request_form" model="ir.ui.view">
            <field name="name">helpdesk.ticket.pause.request.form</field>
            <field name="model">helpdesk.ticket.pause.request</field>
            <field name="arch" type="xml">
                <form string="Solicitud de pausa (ticket)">
                    <sheet>
                        <group>
                            <group>
                                <field name="name" readonly="1"/>
                                <field name="ticket_id" readonly="1"/>
                                <field name="requested_by_id" readonly="1"/>
                                <field name="request_datetime" readonly="1"/>
                                <field name="time_at_request" readonly="1"/>
                                <field name="approver_to_notify_id" readonly="1"/>
                                <field name="state" readonly="1"/>
                            </group>
                            <group invisible="state != 'approved' and state != 'rejected'">
                                <field name="approver_id" readonly="1"/>
                                <field name="approve_datetime" readonly="1"/>
                                <field name="rejection_reason" readonly="1"/>
                            </group>
                        </group>
                        <group invisible="state != 'pending'">
                            <div class="alert alert-info" role="alert">
                                El cronómetro del ticket sigue sumando hasta que un responsable autorice la pausa. Si autoriza, se pausará y se acumulará el tiempo indicado. Si rechaza, el tiempo sigue sumando.
                            </div>
                            <button name="action_approve" string="Autorizar pausa" type="object" class="btn-primary" icon="fa-check"/>
                            <button name="action_reject" string="Rechazar" type="object" class="btn-secondary" icon="fa-times"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="action_helpdesk_ticket_pause_request" model="ir.actions.act_window">
            <field name="name">Solicitudes de pausa (tickets)</field>
            <field name="res_model">helpdesk.ticket.pause.request</field>
            <field name="view_mode">list,form</field>
            <field name="context">{'search_default_filter_pending': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Cuando un técnico mueva un ticket a la etapa "En espera" con el cronómetro en marcha, se creará aquí una solicitud. El cronómetro sigue sumando hasta que un responsable (líder del equipo o manager) la autorice. Si autoriza, se pausa; si rechaza, el tiempo sigue sumando.
                </p>
            </field>
        </record>

        <record id="view_helpdesk_ticket_pause_request_search" model="ir.ui.view">
            <field name="name">helpdesk.ticket.pause.request.search</field>
            <field name="model">helpdesk.ticket.pause.request</field>
            <field name="arch" type="xml">
                <search string="Buscar solicitudes de pausa (tickets)">
                    <field name="ticket_id"/>
                    <field name="requested_by_id"/>
                    <field name="approver_to_notify_id"/>
                    <filter name="filter_pending" string="Pendientes" domain="[('state', '=', 'pending')]"/>
                    <filter name="filter_approved" string="Autorizadas" domain="[('state', '=', 'approved')]"/>
                    <filter name="filter_rejected" string="Rechazadas" domain="[('state', '=', 'rejected')]"/>
                    <separator/>
                    <filter name="filter_my_approvals" string="Por aprobar por mí" domain="[('state', '=', 'pending'), ('approver_to_notify_id', '=', uid)]"/>
                </search>
            </field>
        </record>
    </data>
</odoo>
