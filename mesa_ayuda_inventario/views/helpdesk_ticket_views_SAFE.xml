<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Vista Formulario de Ticket - Extender la vista nativa -->
        <!-- Intentamos múltiples nombres de vista posibles por compatibilidad -->
        <record id="view_helpdesk_ticket_form_inherit_maintenance_v1" model="ir.ui.view">
            <field name="name">helpdesk.ticket.form.inherit.maintenance</field>
            <field name="model">helpdesk.ticket</field>
            <!-- Intentar con el nombre más común primero -->
            <field name="inherit_id" ref="helpdesk.helpdesk_ticket_view_form"/>
            <field name="arch" type="xml">
                <!-- Agregar campos en la pestaña de información adicional -->
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="lot_id" options="{'no_create': True}" domain="[('customer_id', '=', partner_id)]"/>
                </xpath>
                
                <!-- Agregar campos de mantenimiento -->
                <xpath expr="//field[@name='user_id']" position="after">
                    <field name="maintenance_order_id" readonly="1"/>
                    <field name="maintenance_id" readonly="1"/>
                    <field name="maintenance_category"/>
                </xpath>
                
                <!-- Agregar botón para convertir a orden de mantenimiento -->
                <xpath expr="//div[@name='button_box']" position="inside">
                    <button name="action_convert_to_maintenance_order" 
                            string="Crear Orden de Mantenimiento" 
                            type="object" 
                            class="oe_stat_button" 
                            icon="fa-wrench" 
                            invisible="maintenance_order_id"/>
                </xpath>
            </field>
        </record>
        
        <!-- Vista Lista de Ticket - Extender para mostrar campos adicionales -->
        <record id="view_helpdesk_ticket_tree_inherit_maintenance_v1" model="ir.ui.view">
            <field name="name">helpdesk.ticket.tree.inherit.maintenance</field>
            <field name="model">helpdesk.ticket</field>
            <field name="inherit_id" ref="helpdesk.view_helpdesk_ticket_tree"/>
            <field name="arch" type="xml">
                <!-- Agregar columna de equipo -->
                <xpath expr="//field[@name='partner_id']" position="after">
                    <field name="lot_id" optional="hide"/>
                </xpath>
                
                <!-- Agregar columna de categoría mantenimiento -->
                <xpath expr="//field[@name='stage_id']" position="after">
                    <field name="maintenance_category" optional="hide"/>
                </xpath>
            </field>
        </record>
    </data>
</odoo>

