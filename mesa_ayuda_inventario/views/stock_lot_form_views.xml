<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Vista que extiende el formulario de stock.lot para agregar imagen y mantenimientos.
             Heredamos de product_suppiles para que ya exista //sheet/notebook (Odoo 19 base no tiene notebook). -->
        <record id="view_production_lot_form_inherit_maintenance" model="ir.ui.view">
            <field name="name">production.lot.form.maintenance.inherit</field>
            <field name="model">stock.lot</field>
            <field name="inherit_id" ref="product_suppiles.view_production_lot_form_inherit_supplies"/>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <!-- Columna derecha: Odoo 19 base = sheet/group[1]/group[2] (Inventory) -->
                <xpath expr="//sheet/group[1]/group[2]" position="attributes">
                    <attribute name="class" add="o_lot_right_col" separator=" "/>
                </xpath>
                <!-- company_currency_id lo hace visible product_suppiles (heredando de stock_account); aqu칤 no existe a칰n -->
                <!-- Imagen + bot칩n Generar Hoja de Vida (columna derecha, antes del primer campo) -->
                <xpath expr="//sheet/group[1]/group[2]/*[1]" position="before">
                    <div class="o_lot_photo_block o_lot_photo_below_costo">
                        <field name="lot_image" widget="image" 
                               options="{'preview_image': 'lot_image', 'size': [140, 140]}"/>
                        <button name="action_generate_life_sheet" 
                                type="object" 
                                string="Generar Hoja de Vida" 
                                class="btn btn-primary"
                                style="width: 100%; margin-top: 8px;"
                                icon="fa-file-pdf"
                                title="Generar PDF con la hoja de vida completa del equipo"/>
                    </div>
                </xpath>
                
                <!-- Agregar pesta침as de mantenimientos e historial (nivel principal) -->
                <xpath expr="//sheet/notebook" position="inside">
                    <page string="Mantenimientos y Revisiones" name="maintenance_history">
                        <field name="maintenance_ids" nolabel="1" context="{'default_lot_id': id}"/>
                    </page>
                    <page string="Historial de Componentes" name="component_change_history">
                        <div class="alert alert-info" role="alert" style="margin-bottom: 15px; padding: 10px 15px; background-color: #d1ecf1; border: 1px solid #0c5460; border-radius: 4px;">
                            <strong>游늶 Historial de Cambios de Componentes:</strong> Esta pesta침a muestra todos los cambios de componentes registrados en los mantenimientos de este equipo, incluyendo componentes retirados e instalados.
                        </div>
                        <group>
                            <button name="action_view_component_changes" 
                                    type="object" 
                                    string="Ver Historial Completo de Cambios de Componentes" 
                                    class="btn-primary"
                                    icon="fa-list"/>
                        </group>
                        <div style="margin-top: 20px;">
                            <p>Para ver el historial completo de cambios de componentes, haz clic en el bot칩n arriba.</p>
                        </div>
                    </page>
                </xpath>
            </field>
        </record>
    </data>
</odoo>