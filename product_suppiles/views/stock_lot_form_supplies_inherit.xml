<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Vista formulario lote: carga en archivo propio y primero (Odoo 19 base: group name="description"). -->
  <record id="view_production_lot_form_inherit_supplies" model="ir.ui.view">
    <field name="name">production.lot.form.supplies.inherit</field>
    <field name="model">stock.lot</field>
    <field name="inherit_id" ref="stock.view_production_lot_form"/>
    <field name="priority" eval="15"/>
    <field name="arch" type="xml">
      <xpath expr="//form" position="attributes">
        <attribute name="class" add="o_stock_lot_pastel_form" separator=" "/>
      </xpath>
      <xpath expr="//sheet//field[@name='name'][not(ancestor::notebook)]" position="attributes">
        <attribute name="string">Número de serie</attribute>
        <attribute name="placeholder">Ingrese el número de serie</attribute>
      </xpath>
      <xpath expr="//field[@name='product_id']" position="before">
        <field name="inventory_plate" string="Placa de Inventario" placeholder="Ingrese la placa de inventario"/>
        <field name="security_plate" string="Placa de Seguridad" placeholder="Ingrese la placa de seguridad"/>
        <field name="hostname" string="Hostname" placeholder="Ingrese el hostname del equipo"/>
      </xpath>
      <xpath expr="//field[@name='ref']" position="after">
        <field name="model_name"/>
        <field name="billing_code"/>
        <field name="entry_date" string="Fecha Activacion Renting" help="Fecha en que el producto llegó al cliente (para cobro por días)"/>
        <field name="entry_date_display" string="Fecha activación (visible en suscripción)" invisible="1"/>
        <field name="exit_date" string="Fecha Finalizacion Renting" help="Fecha en que el producto salió del cliente (para cobro por días)"/>
        <field name="exit_date_display" string="Fecha finalización (visible en suscripción)" invisible="1"/>
      </xpath>
      <xpath expr="//field[@name='location_id']" position="after">
        <field name="reining_plazo" string="Plazo Renting" help="Plazo en meses o fecha personalizada"/>
        <field name="reining_plazo_custom_months" string="Meses (personalizado)" invisible="reining_plazo != 'custom'" optional="show"/>
      </xpath>
      <xpath expr="//group[@name='description']" position="after">
        <notebook>
        <page string="Información" name="info_group">
          <notebook>
            <page string="Información de Asociación" name="associated_element_info" class="page-associated-info-red" invisible="not is_associated_element">
              <field name="is_associated_element" invisible="1"/>
              <group string="Este producto está asociado como elemento a otro producto principal">
                <div class="alert alert-info" role="alert" style="margin-bottom: 15px;">
                  <strong>ℹ️ Información:</strong> Este serial está asociado como 
                  <field name="associated_item_type" readonly="1"/>
                  a otro producto principal.
                </div>
                <group>
                  <field name="associated_to_principal_product_id" string="Producto Principal" readonly="1" options="{'no_open': False}"/>
                  <field name="associated_to_principal_lot_id" string="Serial Principal" readonly="1" options="{'no_open': False}"/>
                  <field name="associated_to_principal_inventory_plate" string="Placa de Inventario Principal" readonly="1"/>
                  <field name="associated_item_type" string="Tipo de Asociación" readonly="1"/>
                </group>
              </group>
            </page>
            <page string="Recepción / Enlace principal" name="supplies_link">
              <group>
                <field name="is_principal" readonly="1"/>
                <field name="principal_product_id" options="{'no_open': False}"/>
                <field name="principal_lot_id" options="{'no_open': False}"/>
                <field name="purchase_tracking_ref" readonly="1"/>
              </group>
            </page>
            <page string="Elementos Asociados" name="supplies_components">
          <notebook>
            <page string="Elementos Sin Costo" name="supplies_components_no_cost">
              <field name="lot_supply_line_sin_costo_ids" nolabel="1" context="{'default_has_cost': False}">
                <list editable="bottom">
                  <field name="lot_id" readonly="1" string="Serial padre"/>
                  <field name="has_cost" column_invisible="1"/>
                  <field name="item_type" string="Tipo" required="1"/>
                  <field name="available_product_ids" invisible="1" column_invisible="1"/>
                  <field name="product_id" domain="[('id', 'in', available_product_ids)]" options="{'no_create': True}"/>
                  <field name="quantity" invisible="1" column_invisible="1"/>
                  <field name="related_lot_id" required="1" string="Serial"/>
                  <field name="has_associated_items" column_invisible="1"/>
                  <field name="associated_items_summary" string="Tiene asociado" readonly="1"
                         widget="text"
                         decoration-info="has_associated_items == True"
                         help="Muestra los elementos asociados a este componente"/>
                  <field name="associated_items_serials" column_invisible="1"
                         invisible="1"
                         widget="many2many"
                         options="{'no_create': True, 'no_open': True}"/>
                  <field name="associated_items_serials_display" string="Serial" readonly="1"
                         widget="text"
                         decoration-info="has_associated_items == True"
                         help="Seriales de los elementos asociados"/>
                  <field name="uom_id" invisible="1" column_invisible="1"/>
                </list>
                <form>
                  <sheet>
                    <group>
                      <field name="has_cost" invisible="1"/>
                      <field name="item_type" string="Tipo" required="1"/>
                      <field name="available_product_ids" invisible="1"/>
                      <field name="product_id" domain="[('id', 'in', available_product_ids)]" options="{'no_create': True}"/>
                      <field name="quantity"/>
                      <field name="related_lot_id" required="1"/>
                      <field name="uom_id"/>
                    </group>
                  </sheet>
                </form>
              </field>
            </page>
            <page string="Elementos Con Costo" name="supplies_components_with_cost">
              <field name="lot_supply_line_con_costo_ids" nolabel="1" context="{'default_has_cost': True}">
                <list editable="bottom">
                  <field name="lot_id" readonly="1" string="Serial padre"/>
                  <field name="has_cost" column_invisible="1"/>
                  <field name="item_type" string="Tipo" required="1"/>
                  <field name="available_product_ids" invisible="1" column_invisible="1"/>
                  <field name="product_id" domain="[('id', 'in', available_product_ids)]" options="{'no_create': True}"/>
                  <field name="quantity" invisible="1" column_invisible="1"/>
                  <field name="related_lot_id" required="1" string="Serial"/>
                  <field name="cost" string="Costo"/>
                  <field name="has_associated_items" column_invisible="1"/>
                  <field name="associated_items_summary" string="Tiene asociado" readonly="1"
                         widget="text"
                         decoration-info="has_associated_items == True"
                         help="Muestra los elementos asociados a este componente"/>
                  <field name="associated_items_serials" column_invisible="1"
                         invisible="1"
                         widget="many2many"
                         options="{'no_create': True, 'no_open': True}"/>
                  <field name="associated_items_serials_display" string="Serial" readonly="1"
                         widget="text"
                         decoration-info="has_associated_items == True"
                         help="Seriales de los elementos asociados"/>
                  <field name="uom_id" invisible="1" column_invisible="1"/>
                </list>
                <form>
                  <sheet>
                    <group>
                      <field name="has_cost" invisible="1"/>
                      <field name="item_type" string="Tipo" required="1"/>
                      <field name="available_product_ids" invisible="1"/>
                      <field name="product_id" domain="[('id', 'in', available_product_ids)]" options="{'no_create': True}"/>
                      <field name="cost" string="Costo"/>
                      <field name="quantity"/>
                      <field name="related_lot_id" required="1"/>
                      <field name="uom_id"/>
                    </group>
                  </sheet>
                </form>
              </field>
            </page>
          </notebook>
        </page>
          </notebook>
        </page>
        </notebook>
      </xpath>
    </field>
  </record>
</odoo>
