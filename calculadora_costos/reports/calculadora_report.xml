<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Reporte PDF Cotizaci√≥n (simplificado: meses y valor por mes) -->
        <record id="action_report_cotizacion" model="ir.actions.report">
            <field name="name">Cotizaci√≥n Renting</field>
            <field name="model">calculadora.costos</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">calculadora_costos.report_cotizacion</field>
            <field name="report_file">calculadora_costos.report_cotizacion</field>
            <field name="print_report_name">'Cotizaci√≥n - %s' % (object.name or 'Sin Nombre')</field>
            <field name="binding_model_id" ref="model_calculadora_costos"/>
            <field name="binding_type">report</field>
        </record>

        <!-- Plantilla QWeb del Reporte Cotizaci√≥n (solo meses y valor a pagar) -->
        <template id="report_cotizacion">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="calc">
                    <t t-call="web.external_layout">
                        <div class="page" style="padding: 30px; font-family: 'Arial', sans-serif; color: #2c3e50;">
                            <!-- Encabezado: t√≠tulo seg√∫n tipo de operaci√≥n -->
                            <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #4a90e2; padding-bottom: 20px;">
                                <h1 style="color: #4a90e2; margin: 0; font-size: 24px; font-weight: bold;">
                                    <t t-if="calc.tipo_operacion == 'venta'">COTIZACI√ìN DE VENTA</t>
                                    <t t-if="calc.tipo_operacion == 'renting'">COTIZACI√ìN DE RENTING</t>
                                </h1>
                                <p style="color: #6c757d; margin: 10px 0 0 0; font-size: 16px; font-weight: bold;">
                                    <t t-esc="calc.name or 'Sin Nombre'"/>
                                </p>
                                <p t-if="calc.partner_id" style="color: #495057; margin: 5px 0 0 0; font-size: 14px;">
                                    Cliente: <t t-esc="calc.partner_id.display_name"/>
                                </p>
                            </div>

                            <!-- VENTA: solo valor del producto con utilidad por equipo y total -->
                            <t t-if="calc.tipo_operacion == 'venta'">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 25px;">
                                    <p style="margin: 0 0 15px 0; font-size: 14px;"><strong>Valor con utilidad (COP) por √≠tem:</strong></p>
                                    <table style="width: 100%; border-collapse: collapse; background: white;">
                                        <thead><tr style="background: #4a90e2; color: white;"><th style="padding: 10px; text-align: left;">Equipo / √çtem</th><th style="padding: 10px; text-align: right;">Valor con utilidad (COP)</th></tr></thead>
                                        <tbody>
                                            <t t-foreach="calc.get_report_equipos()" t-as="bloque">
                                                <tr>
                                                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><t t-esc="bloque['nombre']"/></td>
                                                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold;">$<t t-esc="'{:,.0f}'.format(bloque['linea'].costo_total_cop if bloque['linea']._name == 'calculadora.costos.line' else calc.costo_total_cop)"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                        <tfoot><tr style="background: #e9ecef; font-weight: bold;"><td style="padding: 10px;">Total</td><td style="padding: 10px; text-align: right;">$<t t-esc="'{:,.0f}'.format(calc.costo_total_cop)"/></td></tr></tfoot>
                                    </table>
                                </div>
                            </t>

                            <!-- RENTING: informaci√≥n b√°sica y 4 escenarios por equipo -->
                            <t t-if="calc.tipo_operacion == 'renting'">
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 25px;">
                                    <p style="margin: 0; font-size: 14px;">
                                        <strong>Total equipos:</strong> <t t-esc="len(calc.get_report_equipos())"/> ‚Äî <strong>Valor total (COP):</strong> $<t t-esc="'{:,.0f}'.format(calc.costo_total_cop)"/>
                                    </p>
                                </div>

                                <t t-set="plazos_lista" t-value="[12, 24, 36, 48, 60]"/>
                                <t t-foreach="calc.get_report_equipos()" t-as="bloque">
                                <div style="margin-bottom: 30px; page-break-inside: avoid;">
                                    <h2 style="color: #4a90e2; margin: 0 0 15px 0; font-size: 18px; border-bottom: 2px solid #4a90e2; padding-bottom: 8px;">
                                        <t t-esc="bloque['nombre']"/>
                                    </h2>
                                    <t t-set="escenarios" t-value="bloque['escenarios']"/>
                                    <!-- Escenario 1 -->
                                    <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #28a745;">
                                        <h3 style="color: #2c3e50; margin: 0 0 12px 0; font-size: 15px;">‚úÖ Escenario 1: <t t-esc="escenarios['escenario_1']['nombre']"/></h3>
                                        <table style="width: 100%; border-collapse: collapse; background: white;">
                                            <thead><tr style="background: #28a745; color: white;"><th style="padding: 8px; text-align: left;">Meses</th><th style="padding: 8px; text-align: right;">Valor (COP/mes)</th></tr></thead>
                                            <tbody>
                                                <tr t-foreach="plazos_lista" t-as="plazo">
                                                    <t t-set="valores" t-value="escenarios['escenario_1']['plazos'][plazo]"/>
                                                    <td style="padding: 6px; border-bottom: 1px solid #dee2e6;"><t t-esc="plazo"/> meses</td>
                                                    <td style="padding: 6px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold;">$<t t-esc="'{:,.0f}'.format(valores['pago_mensual_total'])"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Escenario 2 -->
                                    <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #ff9800;">
                                        <h3 style="color: #2c3e50; margin: 0 0 12px 0; font-size: 15px;">‚ö†Ô∏è Escenario 2: <t t-esc="escenarios['escenario_2']['nombre']"/></h3>
                                        <table style="width: 100%; border-collapse: collapse; background: white;">
                                            <thead><tr style="background: #ff9800; color: white;"><th style="padding: 8px; text-align: left;">Meses</th><th style="padding: 8px; text-align: right;">Valor (COP/mes)</th></tr></thead>
                                            <tbody>
                                                <tr t-foreach="plazos_lista" t-as="plazo">
                                                    <t t-set="valores" t-value="escenarios['escenario_2']['plazos'][plazo]"/>
                                                    <td style="padding: 6px; border-bottom: 1px solid #dee2e6;"><t t-esc="plazo"/> meses</td>
                                                    <td style="padding: 6px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold;">$<t t-esc="'{:,.0f}'.format(valores['pago_mensual_total'])"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Escenario 3 -->
                                    <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #2196f3;">
                                        <h3 style="color: #2c3e50; margin: 0 0 12px 0; font-size: 15px;">üîµ Escenario 3: <t t-esc="escenarios['escenario_3']['nombre']"/></h3>
                                        <table style="width: 100%; border-collapse: collapse; background: white;">
                                            <thead><tr style="background: #2196f3; color: white;"><th style="padding: 8px; text-align: left;">Meses</th><th style="padding: 8px; text-align: right;">Valor (COP/mes)</th></tr></thead>
                                            <tbody>
                                                <tr t-foreach="plazos_lista" t-as="plazo">
                                                    <t t-set="valores" t-value="escenarios['escenario_3']['plazos'][plazo]"/>
                                                    <td style="padding: 6px; border-bottom: 1px solid #dee2e6;"><t t-esc="plazo"/> meses</td>
                                                    <td style="padding: 6px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold;">$<t t-esc="'{:,.0f}'.format(valores['pago_mensual_total'])"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Escenario 4 -->
                                    <div style="background: #fce4ec; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #e91e63;">
                                        <h3 style="color: #2c3e50; margin: 0 0 12px 0; font-size: 15px;">‚ùå Escenario 4: <t t-esc="escenarios['escenario_4']['nombre']"/></h3>
                                        <table style="width: 100%; border-collapse: collapse; background: white;">
                                            <thead><tr style="background: #e91e63; color: white;"><th style="padding: 8px; text-align: left;">Meses</th><th style="padding: 8px; text-align: right;">Valor (COP/mes)</th></tr></thead>
                                            <tbody>
                                                <tr t-foreach="plazos_lista" t-as="plazo">
                                                    <t t-set="valores" t-value="escenarios['escenario_4']['plazos'][plazo]"/>
                                                    <td style="padding: 6px; border-bottom: 1px solid #dee2e6;"><t t-esc="plazo"/> meses</td>
                                                    <td style="padding: 6px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold;">$<t t-esc="'{:,.0f}'.format(valores['pago_mensual_total'])"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </t>
                            </t>

                            <!-- Pie -->
                            <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid #dee2e6; text-align: center; color: #6c757d; font-size: 11px;">
                                <p style="margin: 0;">Cotizaci√≥n generada por Calculadora de Costos. Valores en COP.</p>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>

        <!-- Reporte PDF de Calculadora de Costos (completo) -->
        <record id="action_report_calculadora" model="ir.actions.report">
            <field name="name">Reporte de Calculadora de Costos</field>
            <field name="model">calculadora.costos</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">calculadora_costos.report_calculadora</field>
            <field name="report_file">calculadora_costos.report_calculadora</field>
            <field name="print_report_name">'Reporte Calculadora - %s' % (object.name or 'Sin Nombre')</field>
            <field name="binding_model_id" ref="model_calculadora_costos"/>
            <field name="binding_type">report</field>
        </record>

        <!-- Plantilla QWeb del Reporte -->
        <template id="report_calculadora">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="calc">
                    <t t-call="web.external_layout">
                        <div class="page" style="padding: 30px; font-family: 'Arial', sans-serif; color: #2c3e50;">
                            <!-- Encabezado -->
                            <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #4a90e2; padding-bottom: 20px;">
                                <h1 style="color: #4a90e2; margin: 0; font-size: 28px; font-weight: bold;">
                                    <t t-if="calc.tipo_operacion == 'venta'">REPORTE DE COTIZACI√ìN DE VENTA</t>
                                    <t t-if="calc.tipo_operacion == 'renting'">REPORTE DE CALCULADORA DE COSTOS</t>
                                </h1>
                                <p style="color: #6c757d; margin: 10px 0 0 0; font-size: 16px; font-weight: bold;">
                                    <t t-esc="calc.name or 'Sin Nombre'"/>
                                </p>
                            </div>

                            <!-- Informaci√≥n General -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #4a90e2;">
                                <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #4a90e2; padding-bottom: 8px;">
                                    üìã INFORMACI√ìN GENERAL
                                </h2>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <tr>
                                        <td style="width: 35%; padding: 8px; font-weight: bold; color: #495057;">Tipo de operaci√≥n:</td>
                                        <td style="padding: 8px; color: #212529;"><t t-if="calc.tipo_operacion == 'venta'">Venta</t><t t-if="calc.tipo_operacion == 'renting'">Renting</t></td>
                                    </tr>
                                    <tr t-if="calc.partner_id">
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">Cliente:</td>
                                        <td style="padding: 8px; color: #212529; font-size: 16px;"><strong><t t-esc="calc.partner_id.display_name"/></strong></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">Cotizaci√≥n en:</td>
                                        <td style="padding: 8px; color: #212529;">
                                            <t t-if="calc.moneda_cotizacion == 'usd'">USD (valores convertidos a COP)</t>
                                            <t t-if="calc.moneda_cotizacion == 'cop'">COP (Pesos)</t>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">Valor total con utilidad (COP):</td>
                                        <td style="padding: 8px; color: #212529; font-size: 16px; font-weight: bold;">
                                            $<t t-esc="'{:,.0f}'.format(calc.costo_total_cop)"/>
                                        </td>
                                    </tr>
                                    <tr t-if="calc.tipo_operacion == 'renting' and ((calc.moneda_cotizacion == 'usd' and calc.valor_garantia_usd > 0) or (calc.moneda_cotizacion == 'cop' and calc.valor_garantia_cop > 0))">
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">Garant√≠a Extendida / Seguro:</td>
                                        <td style="padding: 8px; color: #212529; font-size: 16px;">
                                            <t t-if="calc.moneda_cotizacion == 'usd'" t-set="garantia_cop" t-value="calc.valor_garantia_usd * calc.trm * (1 + calc.porcentaje_utilidad / 100.0)"/>
                                            <t t-if="calc.moneda_cotizacion == 'cop'" t-set="garantia_cop" t-value="calc.valor_garantia_cop * (1 + calc.porcentaje_utilidad / 100.0)"/>
                                            $<t t-esc="'{:,.0f}'.format(garantia_cop)"/>
                                        </td>
                                    </tr>
                                    <tr t-if="calc.tipo_operacion == 'renting' and calc.costo_servicios_completos > 0">
                                        <td style="padding: 8px; font-weight: bold; color: #495057;">Servicio T√©cnico:</td>
                                        <td style="padding: 8px; color: #212529; font-size: 16px;">
                                            $<t t-esc="'{:,.0f}'.format(calc.servicio_con_margen_cop)"/>
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <!-- VENTA: tabla valor con utilidad por equipo -->
                            <t t-if="calc.tipo_operacion == 'venta'">
                                <div style="margin-bottom: 25px;">
                                    <h2 style="color: #4a90e2; margin: 0 0 15px 0; font-size: 18px; border-bottom: 2px solid #4a90e2; padding-bottom: 8px;">Valor con utilidad por √≠tem (COP)</h2>
                                    <table style="width: 100%; border-collapse: collapse; background: white;">
                                        <thead><tr style="background: #4a90e2; color: white;"><th style="padding: 10px; text-align: left;">Equipo / √çtem</th><th style="padding: 10px; text-align: right;">Valor con utilidad (COP)</th></tr></thead>
                                        <tbody>
                                            <t t-foreach="calc.get_report_equipos()" t-as="bloque">
                                                <tr>
                                                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6;"><t t-esc="bloque['nombre']"/></td>
                                                    <td style="padding: 8px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold;">$<t t-esc="'{:,.0f}'.format(bloque['linea'].costo_total_cop if bloque['linea']._name == 'calculadora.costos.line' else calc.costo_total_cop)"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                        <tfoot><tr style="background: #e9ecef; font-weight: bold;"><td style="padding: 10px;">Total</td><td style="padding: 10px; text-align: right;">$<t t-esc="'{:,.0f}'.format(calc.costo_total_cop)"/></td></tr></tfoot>
                                    </table>
                                </div>
                            </t>

                            <!-- RENTING: Escenarios por cada equipo (4 escenarios) -->
                            <t t-if="calc.tipo_operacion == 'renting'">
                            <t t-foreach="calc.get_report_equipos()" t-as="bloque">
                                <t t-set="escenarios" t-value="bloque['escenarios']"/>
                                <div style="margin-bottom: 35px;">
                                    <h2 style="color: #4a90e2; margin: 0 0 20px 0; font-size: 20px; border-bottom: 2px solid #4a90e2; padding-bottom: 10px;">
                                        <t t-esc="bloque['nombre']"/>
                                    </h2>
                                    <!-- Escenario 1 -->
                                    <div style="background: #e8f5e9; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #28a745; page-break-inside: avoid;">
                                        <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #28a745; padding-bottom: 8px;">‚úÖ ESCENARIO 1: <t t-esc="escenarios['escenario_1']['nombre']"/></h2>
                                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 5px; overflow: hidden;">
                                            <thead><tr style="background: #28a745; color: white;"><th style="padding: 12px; text-align: left; font-weight: bold;">Plazo</th><th style="padding: 12px; text-align: right; font-weight: bold;">Valor Equipo</th><th style="padding: 12px; text-align: right; font-weight: bold;">Seguro/Garant√≠a</th><th style="padding: 12px; text-align: right; font-weight: bold;">Servicio Mensual</th><th style="padding: 12px; text-align: right; font-weight: bold;">Pago Mensual</th></tr></thead>
                                            <tbody>
                                                <tr t-foreach="[12, 24, 36, 48, 60]" t-as="plazo">
                                                    <t t-set="valores" t-value="escenarios['escenario_1']['plazos'][plazo]"/>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; font-weight: bold;"><t t-esc="plazo"/> meses</td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('valor_equipo_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('garantia_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('servicio_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #28a745;">$<t t-esc="'{:,.0f}'.format(valores['pago_mensual_total'])"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Escenario 2 -->
                                    <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #ff9800; page-break-inside: avoid;">
                                        <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #ff9800; padding-bottom: 8px;">‚ö†Ô∏è ESCENARIO 2: <t t-esc="escenarios['escenario_2']['nombre']"/></h2>
                                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 5px; overflow: hidden;">
                                            <thead><tr style="background: #ff9800; color: white;"><th style="padding: 12px; text-align: left; font-weight: bold;">Plazo</th><th style="padding: 12px; text-align: right; font-weight: bold;">Valor Equipo</th><th style="padding: 12px; text-align: right; font-weight: bold;">Seguro/Garant√≠a</th><th style="padding: 12px; text-align: right; font-weight: bold;">Servicio Mensual</th><th style="padding: 12px; text-align: right; font-weight: bold;">Pago Mensual</th></tr></thead>
                                            <tbody>
                                                <tr t-foreach="[12, 24, 36, 48, 60]" t-as="plazo">
                                                    <t t-set="valores" t-value="escenarios['escenario_2']['plazos'][plazo]"/>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; font-weight: bold;"><t t-esc="plazo"/> meses</td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('valor_equipo_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('garantia_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('servicio_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #ff9800;">$<t t-esc="'{:,.0f}'.format(valores['pago_mensual_total'])"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Escenario 3 -->
                                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #2196f3; page-break-inside: avoid;">
                                        <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #2196f3; padding-bottom: 8px;">üîµ ESCENARIO 3: <t t-esc="escenarios['escenario_3']['nombre']"/></h2>
                                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 5px; overflow: hidden;">
                                            <thead><tr style="background: #2196f3; color: white;"><th style="padding: 12px; text-align: left; font-weight: bold;">Plazo</th><th style="padding: 12px; text-align: right; font-weight: bold;">Valor Equipo</th><th style="padding: 12px; text-align: right; font-weight: bold;">Seguro/Garant√≠a</th><th style="padding: 12px; text-align: right; font-weight: bold;">Servicio Mensual</th><th style="padding: 12px; text-align: right; font-weight: bold;">Pago Mensual</th></tr></thead>
                                            <tbody>
                                                <tr t-foreach="[12, 24, 36, 48, 60]" t-as="plazo">
                                                    <t t-set="valores" t-value="escenarios['escenario_3']['plazos'][plazo]"/>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; font-weight: bold;"><t t-esc="plazo"/> meses</td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('valor_equipo_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('garantia_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('servicio_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #2196f3;">$<t t-esc="'{:,.0f}'.format(valores['pago_mensual_total'])"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <!-- Escenario 4 -->
                                    <div style="background: #fce4ec; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 5px solid #e91e63; page-break-inside: avoid;">
                                        <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #e91e63; padding-bottom: 8px;">‚ùå ESCENARIO 4: <t t-esc="escenarios['escenario_4']['nombre']"/></h2>
                                        <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 5px; overflow: hidden;">
                                            <thead><tr style="background: #e91e63; color: white;"><th style="padding: 12px; text-align: left; font-weight: bold;">Plazo</th><th style="padding: 12px; text-align: right; font-weight: bold;">Valor Equipo</th><th style="padding: 12px; text-align: right; font-weight: bold;">Seguro/Garant√≠a</th><th style="padding: 12px; text-align: right; font-weight: bold;">Servicio Mensual</th><th style="padding: 12px; text-align: right; font-weight: bold;">Pago Mensual</th></tr></thead>
                                            <tbody>
                                                <tr t-foreach="[12, 24, 36, 48, 60]" t-as="plazo">
                                                    <t t-set="valores" t-value="escenarios['escenario_4']['plazos'][plazo]"/>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; font-weight: bold;"><t t-esc="plazo"/> meses</td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('valor_equipo_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('garantia_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right;">$<t t-esc="'{:,.0f}'.format(valores.get('servicio_por_mes', 0))"/></td>
                                                    <td style="padding: 10px; border-bottom: 1px solid #dee2e6; text-align: right; font-weight: bold; color: #e91e63;">$<t t-esc="'{:,.0f}'.format(valores['pago_mensual_total'])"/></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </t>

                            <!-- Explicaci√≥n para el Cliente -->
                            <div style="margin-top: 40px; padding: 25px; background: #f8f9fa; border-radius: 10px; border-left: 5px solid #4a90e2; page-break-inside: avoid;">
                                <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #4a90e2; padding-bottom: 10px;">
                                    üìñ Explicaci√≥n de los Escenarios
                                </h2>
                                
                                <div style="margin-bottom: 25px;">
                                    <h3 style="color: #28a745; font-size: 16px; margin-bottom: 10px;">‚úÖ Escenario 1: Con Seguro y Servicios T√©cnicos</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øQu√© incluye?</strong> Este escenario incluye el equipo completo con garant√≠a extendida y servicios t√©cnicos mensuales.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© se cobra el Valor del Equipo?</strong> Es el costo del equipo con la utilidad aplicada. Incluye el valor base del equipo m√°s la garant√≠a extendida (seguro) que protege tu inversi√≥n.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© se cobra el Seguro/Garant√≠a?</strong> La garant√≠a extendida te protege contra fallas y da√±os del equipo durante el per√≠odo del contrato. Es una protecci√≥n adicional que cubre reparaciones y reemplazos.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© se cobra el Servicio Mensual?</strong> Incluye mantenimiento t√©cnico, soporte, actualizaciones y monitoreo del equipo. Te garantiza que el equipo funcione correctamente durante todo el contrato.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0;">
                                        <strong>Ventaja:</strong> M√°xima protecci√≥n y soporte. No te preocupas por mantenimiento ni reparaciones.
                                    </p>
                                </div>
                                
                                <div style="margin-bottom: 25px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                                    <h3 style="color: #ff9800; font-size: 16px; margin-bottom: 10px;">‚ö†Ô∏è Escenario 2: Sin Seguro pero con Servicios T√©cnicos</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øQu√© incluye?</strong> Este escenario incluye el equipo base (sin garant√≠a extendida) pero con servicios t√©cnicos mensuales.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© se cobra el Valor del Equipo?</strong> Es el costo del equipo base con la utilidad aplicada, pero sin incluir la garant√≠a extendida. Es m√°s econ√≥mico que el Escenario 1.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© NO se cobra el Seguro/Garant√≠a?</strong> Decidiste no incluir la garant√≠a extendida, por lo que no pagas por esta protecci√≥n adicional. Ahorras en el costo inicial.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© se cobra el Servicio Mensual?</strong> Mantienes los servicios t√©cnicos para asegurar el buen funcionamiento del equipo. Incluye mantenimiento, soporte y actualizaciones.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0;">
                                        <strong>Ventaja:</strong> Ahorras en garant√≠a pero mantienes el soporte t√©cnico. Ideal si conf√≠as en la calidad del equipo.
                                    </p>
                                </div>
                                
                                <div style="margin-bottom: 25px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                                    <h3 style="color: #2196f3; font-size: 16px; margin-bottom: 10px;">üîµ Escenario 3: Con Seguro pero sin Servicios T√©cnicos</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øQu√© incluye?</strong> Este escenario incluye el equipo completo con garant√≠a extendida pero sin servicios t√©cnicos mensuales.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© se cobra el Valor del Equipo?</strong> Es el costo del equipo con garant√≠a extendida incluida. Tienes protecci√≥n contra fallas y da√±os.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© se cobra el Seguro/Garant√≠a?</strong> La garant√≠a extendida te protege, pero no incluye mantenimiento preventivo ni soporte t√©cnico continuo.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© NO se cobra el Servicio Mensual?</strong> Decidiste no incluir los servicios t√©cnicos mensuales. T√∫ te encargas del mantenimiento y soporte, o contratas servicios por separado cuando los necesites.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0;">
                                        <strong>Ventaja:</strong> Tienes protecci√≥n (garant√≠a) pero ahorras en servicios mensuales. Ideal si tienes tu propio equipo t√©cnico.
                                    </p>
                                </div>
                                
                                <div style="margin-bottom: 0; padding-top: 20px; border-top: 1px solid #dee2e6;">
                                    <h3 style="color: #e91e63; font-size: 16px; margin-bottom: 10px;">‚ùå Escenario 4: Sin Seguro ni Servicios T√©cnicos</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øQu√© incluye?</strong> Este escenario incluye solo el equipo base, sin garant√≠a extendida ni servicios t√©cnicos mensuales.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© se cobra el Valor del Equipo?</strong> Es el costo del equipo base con la utilidad aplicada. Es la opci√≥n m√°s econ√≥mica.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© NO se cobra el Seguro/Garant√≠a?</strong> No incluyes la garant√≠a extendida. Solo tienes la garant√≠a est√°ndar del fabricante.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 8px;">
                                        <strong>¬øPor qu√© NO se cobra el Servicio Mensual?</strong> No incluyes servicios t√©cnicos mensuales. T√∫ te encargas de todo el mantenimiento y soporte.
                                    </p>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0;">
                                        <strong>Ventaja:</strong> Es la opci√≥n m√°s econ√≥mica. Solo pagas por el equipo. Ideal si tienes tu propio soporte t√©cnico y no necesitas garant√≠a extendida.
                                    </p>
                                </div>
                                
                                <div style="margin-top: 30px; padding: 15px; background: #e3f2fd; border-radius: 5px; border-left: 4px solid #2196f3;">
                                    <p style="color: #1565c0; margin: 0; font-weight: bold; font-size: 14px;">
                                        üí° Nota Importante:
                                    </p>
                                    <p style="color: #495057; margin: 8px 0 0 0; line-height: 1.6; font-size: 13px;">
                                        Los valores mostrados son estimaciones basadas en los par√°metros financieros actuales. El pago mensual incluye intereses calculados seg√∫n la tasa de inter√©s aplicada. Puedes elegir el escenario que mejor se adapte a tus necesidades y presupuesto.
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Explicaci√≥n Detallada de C√°lculos -->
                            <div style="margin-top: 40px; padding: 25px; background: #fff; border-radius: 10px; border: 2px solid #4a90e2; page-break-inside: avoid;">
                                <h2 style="color: #2c3e50; margin-top: 0; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #4a90e2; padding-bottom: 10px;">
                                    üî¢ ¬øC√≥mo se Calculan los Valores?
                                </h2>
                                
                                <div style="margin-bottom: 25px;">
                                    <h3 style="color: #4a90e2; font-size: 16px; margin-bottom: 12px;">1. Valor del Equipo</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 10px;">
                                        El <strong>Valor del Equipo</strong> se calcula de la siguiente manera:
                                    </p>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #4a90e2;">
                                        <p style="color: #495057; margin: 0; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.8;">
                                            <strong>Paso 1:</strong> Sumar el valor del equipo y la garant√≠a (si aplica)<br/>
                                            &#160;&#160;&#160;&#160;Valor Total USD = Valor Equipo USD + Garant√≠a USD<br/><br/>
                                            <strong>Paso 2:</strong> Aplicar el porcentaje de utilidad<br/>
                                            &#160;&#160;&#160;&#160;Costo con Utilidad USD = Valor Total USD √ó (1 + Utilidad% / 100)<br/><br/>
                                            <strong>Paso 3:</strong> Convertir a pesos colombianos usando la TRM<br/>
                                            &#160;&#160;&#160;&#160;Valor del Equipo COP = Costo con Utilidad USD √ó TRM
                                        </p>
                                    </div>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0; font-size: 13px;">
                                        <strong>Ejemplo:</strong> Si el equipo cuesta 500 USD, la garant√≠a 100 USD, la utilidad es 15% y la TRM es 4,000:<br/>
                                        Valor Total = 600 USD ‚Üí Con utilidad = 690 USD ‚Üí En COP = 2,760,000 COP
                                    </p>
                                </div>
                                
                                <div style="margin-bottom: 25px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                                    <h3 style="color: #4a90e2; font-size: 16px; margin-bottom: 12px;">2. Seguro/Garant√≠a Extendida</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 10px;">
                                        El <strong>Seguro/Garant√≠a</strong> se calcula de la siguiente manera:
                                    </p>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #4a90e2;">
                                        <p style="color: #495057; margin: 0; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.8;">
                                            <strong>Paso 1:</strong> Aplicar el porcentaje de utilidad a la garant√≠a<br/>
                                            &#160;&#160;&#160;&#160;Garant√≠a con Utilidad USD = Garant√≠a USD √ó (1 + Utilidad% / 100)<br/><br/>
                                            <strong>Paso 2:</strong> Convertir a pesos colombianos usando la TRM<br/>
                                            &#160;&#160;&#160;&#160;Seguro/Garant√≠a COP = Garant√≠a con Utilidad USD √ó TRM
                                        </p>
                                    </div>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0; font-size: 13px;">
                                        <strong>Ejemplo:</strong> Si la garant√≠a cuesta 100 USD, la utilidad es 15% y la TRM es 4,000:<br/>
                                        Con utilidad = 115 USD ‚Üí En COP = 460,000 COP
                                    </p>
                                </div>
                                
                                <div style="margin-bottom: 25px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                                    <h3 style="color: #4a90e2; font-size: 16px; margin-bottom: 12px;">3. Servicio T√©cnico Mensual</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 10px;">
                                        El <strong>Servicio T√©cnico Mensual</strong> se calcula de la siguiente manera:
                                    </p>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #4a90e2;">
                                        <p style="color: #495057; margin: 0; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.8;">
                                            <strong>Paso 1:</strong> Tomar el costo base de servicios t√©cnicos<br/>
                                            &#160;&#160;&#160;&#160;Costo Base = Costo Servicios Completos (COP)<br/><br/>
                                            <strong>Paso 2:</strong> Aplicar el porcentaje de margen de servicio<br/>
                                            &#160;&#160;&#160;&#160;Servicio Mensual = Costo Base √ó (1 + Margen Servicio% / 100)
                                        </p>
                                    </div>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0; font-size: 13px;">
                                        <strong>Ejemplo:</strong> Si el costo base es 30,000 COP y el margen es 15%:<br/>
                                        Servicio Mensual = 30,000 √ó 1.15 = 34,500 COP/mes
                                    </p>
                                </div>
                                
                                <div style="margin-bottom: 25px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                                    <h3 style="color: #4a90e2; font-size: 16px; margin-bottom: 12px;">4. Pago Mensual</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 10px;">
                                        El <strong>Pago Mensual</strong> se calcula usando la f√≥rmula financiera PMT (Pago Peri√≥dico):
                                    </p>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #4a90e2;">
                                        <p style="color: #495057; margin: 0; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.8;">
                                            <strong>Paso 1:</strong> Calcular la tasa de inter√©s mensual<br/>
                                            &#160;&#160;&#160;&#160;Tasa Mensual = Tasa Nominal% / 12 / 100<br/><br/>
                                            <strong>Paso 2:</strong> Calcular el factor de capitalizaci√≥n<br/>
                                            &#160;&#160;&#160;&#160;Factor = (1 + Tasa Mensual)^Plazo<br/><br/>
                                            <strong>Paso 3:</strong> Calcular el pago base del equipo<br/>
                                            &#160;&#160;&#160;&#160;Pago Base = (Valor Equipo √ó Tasa Mensual √ó Factor) / (Factor - 1)<br/><br/>
                                            <strong>Paso 4:</strong> Ajustar por opci√≥n de compra (si aplica)<br/>
                                            &#160;&#160;&#160;&#160;Ajuste = (Valor Opci√≥n √ó Tasa Mensual) / (Factor - 1)<br/>
                                            &#160;&#160;&#160;&#160;Pago Base Ajustado = Pago Base - Ajuste<br/><br/>
                                            <strong>Paso 5:</strong> Sumar el servicio t√©cnico mensual<br/>
                                            &#160;&#160;&#160;&#160;Pago Mensual Total = Pago Base Ajustado + Servicio Mensual
                                        </p>
                                    </div>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0; font-size: 13px;">
                                        <strong>Ejemplo:</strong> Con un equipo de 2,760,000 COP, tasa 21%, plazo 24 meses, opci√≥n 20% y servicio 34,500:<br/>
                                        Tasa Mensual = 1.75% ‚Üí Factor = 1.5196 ‚Üí Pago Base = 141,230 ‚Üí Con opci√≥n = 122,619 ‚Üí Con servicio = 157,119 COP/mes
                                    </p>
                                </div>
                                
                                <div style="margin-bottom: 0; padding-top: 20px; border-top: 1px solid #dee2e6;">
                                    <h3 style="color: #4a90e2; font-size: 16px; margin-bottom: 12px;">5. ¬øDe D√≥nde Salen los Valores en Cada Escenario?</h3>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 10px;">
                                        Los valores en cada escenario se calculan de la misma manera, pero <strong>incluyendo o excluyendo</strong> ciertos componentes:
                                    </p>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #4a90e2;">
                                        <p style="color: #495057; margin: 0; font-size: 13px; line-height: 1.8;">
                                            <strong>Escenario 1 (Con Seguro y Servicios):</strong><br/>
                                            ‚Ä¢ Valor Equipo = Equipo USD + Garant√≠a USD ‚Üí Con utilidad ‚Üí En COP<br/>
                                            ‚Ä¢ Seguro/Garant√≠a = Garant√≠a USD ‚Üí Con utilidad ‚Üí En COP<br/>
                                            ‚Ä¢ Servicio Mensual = Costo Base √ó (1 + Margen%)<br/>
                                            ‚Ä¢ Pago Mensual = PMT(Valor Equipo con Seguro) + Servicio Mensual<br/><br/>
                                            
                                            <strong>Escenario 2 (Sin Seguro, con Servicios):</strong><br/>
                                            ‚Ä¢ Valor Equipo = Solo Equipo USD ‚Üí Con utilidad ‚Üí En COP<br/>
                                            ‚Ä¢ Seguro/Garant√≠a = 0 (no incluido)<br/>
                                            ‚Ä¢ Servicio Mensual = Costo Base √ó (1 + Margen%)<br/>
                                            ‚Ä¢ Pago Mensual = PMT(Valor Equipo sin Seguro) + Servicio Mensual<br/><br/>
                                            
                                            <strong>Escenario 3 (Con Seguro, sin Servicios):</strong><br/>
                                            ‚Ä¢ Valor Equipo = Equipo USD + Garant√≠a USD ‚Üí Con utilidad ‚Üí En COP<br/>
                                            ‚Ä¢ Seguro/Garant√≠a = Garant√≠a USD ‚Üí Con utilidad ‚Üí En COP<br/>
                                            ‚Ä¢ Servicio Mensual = 0 (no incluido)<br/>
                                            ‚Ä¢ Pago Mensual = PMT(Valor Equipo con Seguro) + 0<br/><br/>
                                            
                                            <strong>Escenario 4 (Sin Seguro ni Servicios):</strong><br/>
                                            ‚Ä¢ Valor Equipo = Solo Equipo USD ‚Üí Con utilidad ‚Üí En COP<br/>
                                            ‚Ä¢ Seguro/Garant√≠a = 0 (no incluido)<br/>
                                            ‚Ä¢ Servicio Mensual = 0 (no incluido)<br/>
                                            ‚Ä¢ Pago Mensual = PMT(Valor Equipo sin Seguro) + 0
                                        </p>
                                    </div>
                                    <p style="color: #495057; line-height: 1.6; margin-bottom: 0; font-size: 13px;">
                                        <strong>Nota:</strong> La f√≥rmula PMT calcula el pago mensual considerando los intereses del financiamiento. A mayor plazo, menor pago mensual pero mayor total a pagar.
                                    </p>
                                </div>
                            </div>
                            </t>

                            <!-- Pie de P√°gina -->
                            <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #dee2e6; text-align: center; color: #6c757d; font-size: 12px;">
                                <p t-if="calc.tipo_operacion == 'renting'">Este reporte muestra diferentes escenarios de financiamiento para comparaci√≥n.</p>
                                <p t-if="calc.tipo_operacion == 'venta'">Cotizaci√≥n de venta: valores con utilidad aplicada (COP).</p>
                                <p style="margin-top: 5px; font-size: 10px;">Los valores mostrados son estimaciones basadas en los par√°metros ingresados.</p>
                            </div>
                        </div>
                    </t>
                </t>
            </t>
        </template>
    </data>
</odoo>
