<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!--
            ============================================================
            HERENCIA DE LA VISTA FORMULARIO DE CONTACTOS
            ============================================================
            Agregamos un botón "Crear Almacén" que solo aparece cuando
            el contacto tiene tipo_contacto = "cliente" o "ambos"
        -->
        <record id="view_partner_form_warehouse_auto_create" model="ir.ui.view">
            <field name="name">res.partner.form.warehouse.auto.create</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <!--
                    Agregar ambos botones juntos después del campo tipo_contacto
                    Solo visible cuando tipo_contacto == "cliente" o "ambos"
                -->
                <xpath expr="//field[@name='tipo_contacto']" position="after">
                    <div class="d-flex gap-2" style="margin-top: 10px; margin-bottom: 10px;">
                        <button name="create_partner_warehouse"
                                string="Crear Almacén"
                                type="object"
                                class="btn-primary"
                                invisible="not is_company or tipo_contacto not in ['cliente', 'ambos']"
                                icon="fa-warehouse"
                                style="background-color: #0052B6 !important; border-color: #0052B6 !important; color: white !important;"/>
                        <button name="action_update_location"
                                string="Actualizar Ubicación"
                                type="object"
                                class="btn-secondary"
                                invisible="not is_company or tipo_contacto not in ['cliente', 'ambos'] or not id"
                                icon="fa-map-marker"/>
                        <button name="action_view_warehouse"
                                string="Ver Almacén"
                                type="object"
                                class="btn-secondary"
                                invisible="not is_company or tipo_contacto not in ['cliente', 'ambos'] or not id"
                                icon="fa-eye"
                                groups="stock.group_stock_manager"/>
                        <button name="action_create_routes_from_form"
                                string="Crear Rutas"
                                type="object"
                                class="btn-secondary"
                                invisible="not is_company or tipo_contacto not in ['cliente', 'ambos']"
                                icon="fa-road"/>
                    </div>
                </xpath>
            </field>
        </record>
        
        <!--
            ============================================================
            ACCIÓN DE SERVIDOR PARA CREAR TODOS LOS ALMACENES
            ============================================================
        -->
        <record id="action_create_all_warehouses_server" model="ir.actions.server">
            <field name="name">Crear Todos los Almacenes</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="binding_model_id" ref="base.model_res_partner"/>
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">
result = model.action_create_all_warehouses()
            </field>
        </record>
        
        <!--
            ============================================================
            ACCIÓN DE SERVIDOR PARA CREAR TODAS LAS RUTAS Y REGLAS
            ============================================================
        -->
        <record id="action_create_all_routes_server" model="ir.actions.server">
            <field name="name">Crear Todas las Rutas y Reglas</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="binding_model_id" ref="base.model_res_partner"/>
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">
result = model.action_create_all_routes()
            </field>
        </record>
        
        <!--
            ============================================================
            ACCIÓN DE SERVIDOR PARA ACTUALIZAR TODAS LAS UBICACIONES
            ============================================================
        -->
        <record id="action_update_all_locations_server" model="ir.actions.server">
            <field name="name">Actualizar Todas las Ubicaciones</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="binding_model_id" ref="base.model_res_partner"/>
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">
result = model.action_update_all_locations()
            </field>
        </record>
        
        <!--
            ============================================================
            CORREGIR TIPO DE OPERACIÓN EN RUTAS DE DEVOLUCIÓN
            ============================================================
            Asigna el tipo de operación de entrega del almacén del cliente
            a la primera regla "Cliente - Transporte" de cada SUPP_DEVOLUCION_*
        -->
        <record id="action_fix_return_route_operation_types_server" model="ir.actions.server">
            <field name="name">Corregir tipo operación rutas de devolución</field>
            <field name="model_id" ref="base.model_res_partner"/>
            <field name="binding_model_id" ref="base.model_res_partner"/>
            <field name="binding_view_types">list</field>
            <field name="state">code</field>
            <field name="code">
result = model.action_fix_return_route_operation_types()
            </field>
        </record>
        
    </data>
</odoo>

