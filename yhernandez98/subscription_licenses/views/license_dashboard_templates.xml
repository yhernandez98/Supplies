<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="dashboard_page" name="Dashboard de Licencias">
        <html>
                <head>
                    <meta charset="utf-8"/>
                    <meta name="viewport" content="width=device-width, initial-scale=1"/>
                    <title>Dashboard de Licencias</title>
                    <style>
                        * { box-sizing: border-box; }
                        body { margin: 0; font-family: "Inter", "Segoe UI", system-ui, sans-serif; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 40%, #f8fafc 100%); min-height: 100vh; color: #1e293b; }
                        .ld_header { background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%); color: #fff; padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem; box-shadow: 0 4px 20px rgba(37,99,235,0.25); }
                        .ld_header h1 { margin: 0; font-size: 1.5rem; font-weight: 700; letter-spacing: -0.02em; }
                        .ld_header_links { display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; }
                        .ld_header_links a { color: rgba(255,255,255,0.95); text-decoration: none; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; font-weight: 500; transition: background 0.2s; }
                        .ld_header_links a:hover { background: rgba(255,255,255,0.2); }
                        .ld_container { max-width: 1200px; margin: 0 auto; padding: 1.5rem; }
                        .ld_kpi_row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.25rem; margin-bottom: 2rem; }
                        .ld_kpi_card { background: #fff; border-radius: 16px; padding: 1.5rem; box-shadow: 0 4px 24px rgba(0,0,0,0.06); border: 1px solid rgba(0,0,0,0.04); transition: transform 0.2s, box-shadow 0.2s; }
                        .ld_kpi_card:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(0,0,0,0.08); }
                        .ld_kpi_card.primary { background: linear-gradient(145deg, #2563eb 0%, #1d4ed8 100%); color: #fff; }
                        .ld_kpi_card.success { background: linear-gradient(145deg, #10b981 0%, #059669 100%); color: #fff; }
                        .ld_kpi_card.accent { background: linear-gradient(145deg, #0ea5e9 0%, #0284c7 100%); color: #fff; }
                        .ld_kpi_card.orange { background: linear-gradient(145deg, #f59e0b 0%, #d97706 100%); color: #fff; }
                        .ld_kpi_label { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.9; margin-bottom: 0.35rem; }
                        .ld_kpi_value { font-size: 2.25rem; font-weight: 800; letter-spacing: -0.03em; line-height: 1.1; }
                        .ld_section { background: #fff; border-radius: 16px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 24px rgba(0,0,0,0.06); border: 1px solid rgba(0,0,0,0.04); }
                        .ld_section_title { font-size: 1.1rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid #e2e8f0; }
                        .ld_table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
                        .ld_table th { text-align: left; padding: 0.75rem 1rem; color: #64748b; font-weight: 600; }
                        .ld_table td { padding: 0.75rem 1rem; border-top: 1px solid #f1f5f9; }
                        .ld_table tr:hover td { background: #f8fafc; }
                        .ld_table .num { text-align: right; font-weight: 600; }
                        .ld_cta { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.6rem 1.2rem; background: #2563eb; color: #fff; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 0.9rem; margin-top: 0.75rem; transition: background 0.2s; }
                        .ld_cta:hover { background: #1d4ed8; color: #fff; }
                        .ld_grid2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem; }
                        .ld_mini_card { background: #fff; border-radius: 12px; padding: 1rem 1.25rem; box-shadow: 0 2px 12px rgba(0,0,0,0.05); border-left: 4px solid #94a3b8; }
                        .ld_mini_card.warn { border-left-color: #f59e0b; }
                        .ld_mini_card.danger { border-left-color: #ef4444; }
                        .ld_mini_card .label { font-size: 0.75rem; color: #64748b; margin-bottom: 0.25rem; }
                        .ld_mini_card .val { font-size: 1.5rem; font-weight: 700; color: #1e293b; }
                        .ld_bar_wrap { margin-bottom: 0.75rem; }
                        .ld_bar_label { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 0.25rem; }
                        .ld_bar { height: 24px; background: #e2e8f0; border-radius: 8px; overflow: hidden; }
                        .ld_bar_fill { height: 100%; border-radius: 8px; background: linear-gradient(90deg, #2563eb, #0ea5e9); transition: width 0.3s; }
                        .ld_bar_fill.orange { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
                        .ld_bar_fill.green { background: linear-gradient(90deg, #10b981, #34d399); }
                    </style>
                </head>
                <body>
                    <header class="ld_header">
                        <h1>üìä Dashboard de Licencias</h1>
                        <div class="ld_header_links">
                            <a t-attf-href="#{url_back}">‚Üê Volver</a>
                            <a t-attf-href="#{url_list}">Ver listado</a>
                            <a t-attf-href="#{url_assignments}">Asignaciones</a>
                            <a t-attf-href="#{url_providers}">Proveedores</a>
                        </div>
                    </header>
                    <div class="ld_container">
                        <div class="ld_kpi_row">
                            <div class="ld_kpi_card primary">
                                <div class="ld_kpi_label">Tipos de licencia</div>
                                <div class="ld_kpi_value" t-esc="total_licenses"/>
                            </div>
                            <div class="ld_kpi_card success">
                                <div class="ld_kpi_label">Licencias en uso</div>
                                <div class="ld_kpi_value" t-esc="total_used"/>
                            </div>
                            <div class="ld_kpi_card accent">
                                <div class="ld_kpi_label">Asignaciones activas</div>
                                <div class="ld_kpi_value" t-esc="total_assignments"/>
                            </div>
                            <div class="ld_kpi_card orange">
                                <div class="ld_kpi_label">Proveedores</div>
                                <div class="ld_kpi_value" t-esc="total_providers"/>
                            </div>
                        </div>
                        <div class="ld_section">
                        <div class="ld_section_title">Pr√≥ximas a vencer</div>
                        <div class="ld_grid2">
                            <div class="ld_mini_card danger">
                                <div class="label">Vencen en 30 d√≠as</div>
                                <div class="val" t-esc="expiring_30"/>
                            </div>
                            <div class="ld_mini_card warn">
                                <div class="label">Vencen en 60 d√≠as</div>
                                <div class="val" t-esc="expiring_60"/>
                            </div>
                            <div class="ld_mini_card">
                                <div class="label">Vencen en 90 d√≠as</div>
                                <div class="val" t-esc="expiring_90"/>
                            </div>
                        </div>
                        <t t-if="expiring_list">
                            <table class="ld_table">
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Licencia</th>
                                        <th>Proveedor</th>
                                        <th class="num">Fecha fin</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="expiring_list" t-as="row">
                                        <tr>
                                            <td t-esc="row['client']"/>
                                            <td t-esc="row['license']"/>
                                            <td t-esc="row['provider']"/>
                                            <td class="num" t-esc="row['end_date']"/>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </t>
                        <a t-attf-href="#{url_assignments}" class="ld_cta">Ver asignaciones ‚Üí</a>
                        </div>
                        <div class="ld_section">
                            <div class="ld_section_title">Por categor√≠a</div>
                            <t t-if="by_category">
                                <table class="ld_table">
                                    <thead>
                                        <tr>
                                            <th>Categor√≠a</th>
                                            <th class="num">Tipos</th>
                                            <th class="num">En uso</th>
                                            <th class="num">Asignaciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-foreach="by_category" t-as="row">
                                            <tr>
                                                <td t-esc="row['name']"/>
                                                <td class="num" t-esc="row['count']"/>
                                                <td class="num" t-esc="row['used']"/>
                                                <td class="num" t-esc="row['assignments']"/>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </t>
                            <t t-else="">
                                <p style="color: #64748b; margin: 0;">No hay licencias activas por categor√≠a.</p>
                            </t>
                            <a t-attf-href="#{url_list}" class="ld_cta">Ver listado completo ‚Üí</a>
                            <div class="ld_section_title" style="margin-top: 1.25rem;">En uso por categor√≠a</div>
                            <t t-if="by_category">
                                <t t-foreach="by_category" t-as="row">
                                    <div class="ld_bar_wrap">
                                        <div class="ld_bar_label">
                                            <span t-esc="row['name']"/>
                                            <span t-esc="row['used']"/>
                                        </div>
                                        <div class="ld_bar">
                                            <div class="ld_bar_fill green" t-att-style="row['bar_style']"/>
                                        </div>
                                    </div>
                                </t>
                            </t>
                        </div>
                        <div class="ld_section">
                        <div class="ld_section_title">Proveedores con m√°s licencias contratadas</div>
                        <t t-if="top_providers">
                            <t t-foreach="top_providers" t-as="item">
                                <div class="ld_bar_wrap">
                                    <div class="ld_bar_label">
                                        <span t-esc="item['name']"/>
                                        <span t-esc="item['qty']"/>
                                    </div>
                                    <div class="ld_bar">
                                        <div class="ld_bar_fill orange" t-att-style="item['bar_style']"/>
                                    </div>
                                </div>
                            </t>
                        </t>
                        <t t-else="">
                            <p style="color: #64748b; margin: 0;">No hay datos de proveedores con asignaciones activas.</p>
                        </t>
                        <a t-attf-href="#{url_providers}" class="ld_cta">Ver proveedores ‚Üí</a>
                        </div>
                    </div>
                </body>
            </html>
    </template>

    <record id="action_license_dashboard" model="ir.actions.act_url">
        <field name="name">Dashboard de Licencias</field>
        <field name="url">/subscription_licenses/dashboard</field>
        <field name="target">self</field>
    </record>
</odoo>
