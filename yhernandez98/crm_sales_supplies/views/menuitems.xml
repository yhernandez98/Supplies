<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Men칰 de Alertas Por Cotizaci칩n -->
        <menuitem id="menu_purchase_alert"
                  name="Alertas Por Cotizaci칩n"
                  parent="purchase.menu_purchase_root"
                  action="action_purchase_alert"
                  sequence="30"/>
        
        <!-- Vista de lista para stock.quant de Supp/Existencias - Dise침o profesional y corporativo -->
        <record id="view_supplies_stock_quant_list" model="ir.ui.view">
            <field name="name">stock.quant.supplies.list</field>
            <field name="model">stock.quant</field>
            <field name="arch" type="xml">
                <list string="Inventario General" 
                      default_order="product_id, lot_id"
                      sample="1"
                      create="false"
                      edit="false"
                      delete="false"
                      class="crm-inventory-list">
                    <field name="product_id" string="Producto" 
                           widget="many2one"
                           options="{'no_create': True, 'no_open': True}"/>
                    <field name="lot_id" string="N칰mero de Serie/Lote"
                           widget="many2one"
                           options="{'no_create': True, 'no_open': True}"/>
                    <field name="inventory_plate" string="Placa de Inventario" 
                           optional="show"
                           widget="char"/>
                    <field name="related_products_ids" string="Hardware Asociado" 
                           widget="many2many_tags" 
                           optional="show"
                           options="{'no_create': True, 'color_field': 'color'}"/>
                    <field name="is_leasing" string="Es Leasing" 
                           widget="boolean_toggle"
                           optional="show"/>
                    <field name="leasing_brand_id" string="Marca Leasing"
                           optional="hide"/>
                    <field name="quantity" string="Cantidad" 
                           widget="float" 
                           optional="hide"
                           sum="Total"
                           default_focus="1"/>
                    <field name="in_date" string="Fecha de Entrada" 
                           widget="date"
                           optional="show"/>
                </list>
            </field>
        </record>
        
        <!-- Vista de b칰squeda para stock.quant con filtro de producto principal -->
        <record id="view_supplies_stock_quant_search" model="ir.ui.view">
            <field name="name">stock.quant.supplies.search</field>
            <field name="model">stock.quant</field>
            <field name="arch" type="xml">
                <search string="Inventario Supp/Existencias">
                    <field name="product_id" string="Producto"/>
                    <field name="lot_id" string="N칰mero de serie/lote"/>
                    <field name="inventory_plate" string="Placa de Inventario"/>
                    <field name="parent_product_id" string="Producto Principal" 
                           widget="many2one" 
                           options="{'no_create': True}"/>
                    <field name="location_id" string="Ubicaci칩n"/>
                    <field name="related_products_ids" string="Hardware Asociado" 
                           filter_domain="[('related_products_ids', 'ilike', self)]"/>
                    <field name="is_leasing"/>
                    <field name="leasing_brand_id"/>
                    <separator/>
                    <filter string="Productos de Leasing" name="leasing" domain="[('is_leasing', '=', True)]"/>
                    <filter string="Productos Normales" name="no_leasing" domain="[('is_leasing', '=', False)]"/>
                    <separator/>
                    <filter string="Producto" name="product" context="{'group_by': 'product_id'}"/>
                    <filter string="Lote/Serie" name="lot" context="{'group_by': 'lot_id'}"/>
                    <filter string="Ubicaci칩n" name="locationgroup" context="{'group_by': 'location_id'}"/>
                </search>
            </field>
        </record>
        
        <!-- Acci칩n para ver inventario de Supp/Existencias -->
        <record id="action_view_supplies_stock" model="ir.actions.act_window">
            <field name="name">Inventario</field>
            <field name="res_model">stock.quant</field>
            <field name="view_mode">list,form</field>
            <field name="view_id" ref="view_supplies_stock_quant_list"/>
            <field name="search_view_id" ref="view_supplies_stock_quant_search"/>
            <field name="domain">[
                ('location_id.complete_name', 'ilike', 'Supp/Existencias'),
                ('location_id.usage', '=', 'internal'),
                ('quantity', '>', 0)
            ]</field>
            <field name="context">{'filter_associated_items': True}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    游닍 Inventario de Supp/Existencias
                </p>
                <p>
                    <strong>B칰squeda inteligente:</strong> Escribe cualquier t칠rmino (ej: "I7", "RAM", "SSD") en la barra de b칰squeda 
                    y el sistema buscar치 tanto en el nombre del producto como en el hardware asociado.
                </p>
                <p>
                    <strong>Filtros disponibles:</strong> Utiliza los filtros de la barra de b칰squeda para agrupar por Producto, 
                    Lote/Serie o Ubicaci칩n.
                </p>
            </field>
        </record>
        
        <!-- Men칰 en el CRM entre Reportes y Configuraci칩n -->
        <menuitem id="menu_crm_supplies_stock"
                  name="Inventario"
                  parent="crm.crm_menu_root"
                  action="action_view_supplies_stock"
                  sequence="20"/>
        
        <!-- Acci칩n para ver inventario de productos de Leasing -->
        <record id="action_view_supplies_stock_leasing" model="ir.actions.act_window">
            <field name="name">Inventario Leasing</field>
            <field name="res_model">stock.quant</field>
            <field name="view_mode">list,form</field>
            <field name="view_id" ref="view_supplies_stock_quant_list"/>
            <field name="search_view_id" ref="view_supplies_stock_quant_search"/>
            <field name="domain">[
                ('location_id.complete_name', 'ilike', 'Supp/Existencias'),
                ('location_id.usage', '=', 'internal'),
                ('quantity', '>', 0),
                ('is_leasing', '=', True)
            ]</field>
            <field name="context">{'filter_associated_items': True, 'search_default_leasing': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    游닍 Inventario de Productos de Leasing
                </p>
                <p>
                    <strong>Inventario de Leasing:</strong> Esta vista muestra 칰nicamente los productos que est치n incluidos 
                    en contratos de leasing con grandes marcas (HP, Dell, etc.)
                </p>
                <p>
                    <strong>B칰squeda inteligente:</strong> Escribe cualquier t칠rmino (ej: "I7", "RAM", "SSD") en la barra de b칰squeda 
                    y el sistema buscar치 tanto en el nombre del producto como en el hardware asociado.
                </p>
            </field>
        </record>
        
        <!-- Men칰 de Cotizaciones Solicitadas para CRM -->
        <menuitem id="menu_crm_purchase_alerts"
                  name="Cotizaciones Solicitadas"
                  parent="crm.crm_menu_root"
                  action="action_purchase_alert_crm"
                  sequence="21"/>
        
        <!-- Actualizar la secuencia del men칰 para asegurar el orden correcto -->
        <record id="menu_crm_supplies_stock" model="ir.ui.menu">
            <field name="sequence">20</field>
        </record>
        
        <record id="menu_crm_purchase_alerts" model="ir.ui.menu">
            <field name="sequence">21</field>
        </record>
        
        <!-- Men칰 de Leasing en CRM - DEBE IR PRIMERO para que los hijos puedan referenciarlo -->
        <menuitem id="menu_crm_leasing_root"
                  name="Leasing"
                  parent="crm.crm_menu_root"
                  sequence="22"/>
        
        <!-- Men칰s hijos de Leasing -->
        <menuitem id="menu_crm_leasing_contracts"
                  name="Contratos de Leasing"
                  parent="menu_crm_leasing_root"
                  action="action_leasing_contract"
                  sequence="10"/>
        
        <menuitem id="menu_crm_leasing_brands"
                  name="Marcas"
                  parent="menu_crm_leasing_root"
                  action="action_leasing_brand"
                  sequence="20"/>
        
        <menuitem id="menu_crm_leasing_inventory"
                  name="Inventario Leasing"
                  parent="menu_crm_leasing_root"
                  action="action_view_supplies_stock_leasing"
                  sequence="30"/>
        
        <menuitem id="menu_leasing_contract_templates"
                  name="Plantillas"
                  parent="menu_crm_leasing_root"
                  action="action_leasing_contract_template"
                  sequence="40"/>
        
    </data>
</odoo>

